#########
#Made by claivin for Missions Expanded Mod
#########

RAM_missions_1 = {
	slot = 1
	generic = no
	ai = yes
	potential = {
		NOT = { tag = RUM }
		OR = {
			tag = RAM
			was_tag = RAM
		}
		NOT = { has_country_flag = ME_TUR_Change_Tree }
	}
	has_country_shield = yes

	RAM_allies = {
		icon = me_mission_ottomans_a_mamluk_buffer
		required_missions = { beylik_force_limit_mission }
		position = 2
		provinces_to_highlight = {
			OR = {
				owned_by = TUR
				owned_by = MAM
			}
			NOT = { owned_by = ROOT }
		}
		trigger = {
			is_at_war = no
			if = {
				limit = {
					exists = TUR
					exists = MAM
				}
				OR = {
					AND = {
						alliance_with = TUR
						marriage_with = TUR
						NOT = { alliance_with = MAM }
					}
					AND = {
						alliance_with = MAM
						marriage_with = MAM
						NOT = { alliance_with = TUR }
					}
					AND = {
						TUR = { has_been_insulted_by_root = yes }
						MAM = { has_been_insulted_by_root = yes }
					}
				}
			}
			else = {
				num_of_allies = 2
			}
		}
		effect = {
			custom_tooltip = ram_ally_tt
			hidden_effect = {
				if = {
					limit = {
						alliance_with = TUR
					}
					create_general = {
						tradition = 50
						add_siege = 2
					}
				}
				else_if = {
					limit = {
						alliance_with = MAM
					}
					add_country_modifier = {
						name = ram_manpower
						duration = 12775
					}
				}
				else_if = {
					limit = {
						AND = {
							TUR = { has_been_insulted_by_root = yes }
							MAM = { has_been_insulted_by_root = yes }
						}
					}
					add_country_modifier = {
						name = ram_home_defense
						duration = 9125
					}
				}
				else = {
					add_dip_power = 100
				}
			}
		}
	}
}

RAM_missions_5 = {
	slot = 5
	generic = no
	ai = yes
	potential = {
		NOT = { tag = RUM }
		OR = {
			tag = RAM
			was_tag = RAM
		}
		NOT = { has_country_flag = ME_TUR_Change_Tree }
	}
	has_country_shield = yes
	
	RAM_copts = {
		icon = me_ram_copt
		required_missions = { beylik_force_limit_mission }
		position = 2
		provinces_to_highlight = {
			OR = {
				province_id = 358
				province_id = 1227
				province_id = 2313
				province_id = 1234
				province_id = 419
			}
			NOT = { owned_by = ROOT }
		}
		trigger = {
			OR = { #coptic sites
				358 = {
					owned_by = ROOT
				}
				1227 = {
					owned_by = ROOT
				}
				2313 = {
					owned_by = ROOT
				}
				1234 = {
					owned_by = ROOT
				}
				419 = {
					owned_by = ROOT
				}
			}
			theologian = 1
		}
		effect = {
			country_event = {
				id = ME_Beylik_Events.10
			}
		}
	}
}

ME_Ramazan_incident_missions_1 = {
	slot = 1
	generic = no
	ai = yes
	potential = {
		tag = RAM
		has_country_flag = ME_TUR_Change_Tree
	}
	has_country_shield = yes

	RAM_Wing_Plucking = {
		icon = me_ram_copt
		position = 2
		trigger = {
			custom_trigger_tooltip = {
				tooltip = ME_RAM_Occupy_Provinces_tt
				OR = {
					num_of_owned_provinces_with = {
						value = 15
						owned_by = PLC
						controlled_by = TUR
					}
					num_of_owned_provinces_with = {
						value = 15
						owned_by = POL
						controlled_by = TUR
					}
				}
			}
		}
		effect = {
			if = {
				limit = {
					num_of_owned_provinces_with = {
						value = 15
						owned_by = PLC
						controlled_by = TUR
					}
				}
				PLC = {
					add_country_modifier = {
						name = ME_TUR_Crippled_Horse_Supply
						duration = -1
					}	
				}
			}
			else = {
				POL = {
					add_country_modifier = {
						name = ME_TUR_Crippled_Horse_Supply
						duration = -1
					}	
				}
			}
		}
	}
}

ME_Ramazan_incident_missions_2 = {
	slot = 2
	generic = no
	ai = yes
	potential = {
		tag = RAM
		has_country_flag = ME_TUR_Change_Tree
	}
	has_country_shield = yes

	RAM_Preparing_Forces = {
		icon = me_ram_copt
		position = 1
		trigger = {
			TUR = {
				OR = {
					army_size_percentage = 0.1
					army_size = 100
				}
			}
		}
		effect = {
			TUR = {
				add_country_modifier = {
					name = ME_TUR_Ottoman_Storm
					duration = -1
				}
			}
			hidden_effect = {
				export_to_variable = {
					which = ME_TUR_starting_army_variable
					value = trigger_value:army_size
				}
			}
		}
	}

	RAM_Supplying_Front = {
		icon = me_ram_copt
		required_missions = { RAM_Preparing_Forces }
		position = 2
		trigger = {
			custom_trigger_tooltip = {
				tooltip = ME_TUR_increased_army_by_twenty
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = ME_TUR_soldier_current_variable
						value = trigger_value:army_size
					}
					change_variable = {
						which = ME_TUR_soldier_current_variable
						value = -20
					}
					check_variable = {
						which = ME_TUR_soldier_current_variable
						which = ME_TUR_starting_army_variable
					}
				}
			}
		}
		effect = {
			custom_tooltip = ME_TUR_supply_network_reward
			hidden_effect = {
				add_country_modifier = {
					name = ME_TUR_supply_network
					duration = -1
				}
			}
		}
	}

	RAM_Pride_Humiliation = {
		icon = me_ram_copt
		position = 3
		required_missions = { 
			RAM_Wing_Plucking
			RAM_Supplying_Front
		}
		trigger = {
			if = {
				limit = {
					exists = PLC
					TUR = {
						is_in_war = {
							attacker_leader = TUR
							casus_belli = ME_Ottomans_Roman_Facade_CB
							participants = PLC
						}
					}
				}
			}
			PLC = {
				current_war_losses = { 
					who_with = TUR
					type = cavalry
					cause = battle
					amount = 30
				}
			}
			else_if = {
				limit = {
					NOT = { exists = PLC }
					exists = POL
					TUR = {
						is_in_war = {
							attacker_leader = TUR
							casus_belli = ME_Ottomans_Roman_Facade_CB
							participants = POL
						}
					}
				}
				POL = {
					current_war_losses = { 
						who_with = TUR
						type = cavalry
						cause = battle
						amount = 30
					}
				}
			}
			else = { always = yes }
		}
		effect = {
			if = {
				limit = {
					TUR = {
						is_in_war = {
							attacker_leader = TUR
							casus_belli = ME_Ottomans_Roman_Facade_CB
							participants = PLC
						}
					}
				}
				add_power_projection = {
					type = ME_bested_winged_hussars
					amount = 20
				}
			}
			else_if = {
				limit = {
					TUR = {
						is_in_war = {
							attacker_leader = TUR
							casus_belli = ME_Ottomans_Roman_Facade_CB
							participants = POL
						}
					}
				}
				add_power_projection = {
					type = ME_bested_winged_hussars
					amount = 20
				}
			}
			else = { add_prestige = 10 }
		}
	}
}

ME_Ramazan_incident_missions_3 = {
	slot = 3
	generic = no
	ai = yes
	potential = {
		tag = RAM
		has_country_flag = ME_TUR_Change_Tree
	}
	has_country_shield = yes

	RAM_cloak_dagger = {
		icon = me_ram_copt
		position = 1
		trigger = {
			calc_true_if = {
				amount = 2
				all_country = {
					has_spy_network_from = {
						who = ROOT
						value = 25
					}
				}
			}
		}
		effect = {
			random_country = {
				limit = {
					is_in_war = {
						attacker_leader = ROOT
						casus_belli = ME_Ottomans_Roman_Facade_CB
						participants = PREV
					}
				}
				set_country_flag = ME_TUR_removed_fow
				remove_fow = 24
			}
			random_country = {
				limit = {
					is_in_war = {
						attacker_leader = ROOT
						casus_belli = ME_Ottomans_Roman_Facade_CB
						participants = PREV
					}
					NOT = { has_country_flag = ME_TUR_removed_fow }
				}
				remove_fow = 24
			}
		}
	}

	RAM_Time_Need = {
		icon = me_ram_copt
		position = 3
		required_missions = { 
			RAM_Supplying_Front 
			RAM_art_war
		}
		trigger = {
			if = {
				limit = {
					exists = SPA
				}
				SPA = {
					current_war_losses = { 
						who_with = TUR
						type = infantry
						cause = battle
						amount = 60
					}
				}
				SPA = {
					current_war_losses = { 
						who_with = TUR
						type = artillery
						cause = battle
						amount = 20
					}
				}
			}
			else_if = {
				limit = {
					NOT = { exists = SPA }
					exists = CAS
				}
				CAS = {
					current_war_losses = { 
						who_with = TUR
						type = infantry
						cause = battle
						amount = 60
					}
				}
				CAS = {
					current_war_losses = { 
						who_with = TUR
						type = artillery
						cause = battle
						amount = 20
					}
				}
			}
			else_if = {
				limit = {
					NOT = { exists = SPA }
					NOT = { exists = CAS }
					exists = ARA
				}
				ARA = {
					current_war_losses = { 
						who_with = TUR
						type = infantry
						cause = battle
						amount = 60
					}
				}
				ARA = {
					current_war_losses = { 
						who_with = TUR
						type = artillery
						cause = battle
						amount = 20
					}
				}
			}
			else_if = {
				limit = {
					NOT = { exists = SPA }
					NOT = { exists = CAS }
					NOT = { exists = ARA }
					exists = POR
				}
				POR = {
					current_war_losses = { 
						who_with = TUR
						type = infantry
						cause = battle
						amount = 60
					}
				}
				POR = {
					current_war_losses = { 
						who_with = TUR
						type = artillery
						cause = battle
						amount = 20
					}
				}
			}
			else_if = {
				limit = {
					NOT = { exists = SPA }
					NOT = { exists = CAS }
					NOT = { exists = ARA }
					NOT = { exists = POR }
				}
				always = yes
			}
		}
		effect = {
			if = {
				limit = {
					TUR = {
						is_in_war = {
							attacker_leader = TUR
							casus_belli = ME_Ottomans_Roman_Facade_CB
							participants = SPA
						}
					}
				}
				TUR = { 
					country_event = { id = ME_Ottoman_Events.82 }
				}
			}
			else_if = {
				limit = {
					TUR = {
						is_in_war = {
							attacker_leader = TUR
							casus_belli = ME_Ottomans_Roman_Facade_CB
							participants = CAS
						}
					}
				}
				TUR = { 
					country_event = { id = ME_Ottoman_Events.82 }
				}
			}
			else_if = {
				limit = {
					TUR = {
						is_in_war = {
							attacker_leader = TUR
							casus_belli = ME_Ottomans_Roman_Facade_CB
							participants = ARA
						}
					}
				}
				TUR = { 
					country_event = { id = ME_Ottoman_Events.82 }
				}
			}
			else_if = {
				limit = {
					TUR = {
						is_in_war = {
							attacker_leader = TUR
							casus_belli = ME_Ottomans_Roman_Facade_CB
							participants = POR
						}
					}
				}
				TUR = { 
					country_event = { id = ME_Ottoman_Events.82 }
				}
			}
			else = { add_prestige = 1 }
		}
	}

	RAM_Show_Strength = {
		icon = me_ram_copt
		position = 4
		required_missions = { 
			RAM_Pride_Humiliation
			RAM_Time_Need
			RAM_Fishing_Off
		}
		provinces_to_highlight = {
			is_capital = yes
			owner = { is_emperor = yes }
		}
		trigger = {
			any_province = {
				owned_by = emperor
				is_capital = yes
				controlled_by = TUR
			}
			emperor = {
				NOT = { army_size_percentage = 0.1 }
			}
			num_of_cities = 1
		}
		effect = {
			if = {
				limit = {
					any_province = {
						owned_by = emperor
						is_capital = yes
						controlled_by = TUR
					}
					emperor = {
						NOT = { army_size_percentage = 0.1 }
					}
					num_of_cities = 1
				}
				TUR = {
					add_prestige = 25
					add_adm_power = 100
					add_dip_power = 100
					add_mil_power = 100
					add_power_projection = {
						type = ME_defeated_emperor
						amount = 50
					}
				}
			}
			TUR = { inherit = RAM }
			hidden_effect = {
				every_country = {
					limit = {
						has_country_modifier = ME_TUR_Crippled_Horse_Supply
					}
					remove_country_modifier = ME_TUR_Crippled_Horse_Supply
				}
				remove_country_modifier = ME_TUR_Ottoman_Storm
				every_elector = {
					remove_opinion = {
						who = emperor
						modifier = ME_TUR_abandoned
					}
				}
			}
			TUR = { set_country_flag = ME_TUR_Roman_Facade_End }
		}
	}
}

ME_Ramazan_incident_missions_4 = {
	slot = 4
	generic = no
	ai = yes
	potential = {
		tag = RAM
		has_country_flag = ME_TUR_Change_Tree
	}
	has_country_shield = yes

	RAM_War_Time_Policies = {
		icon = me_ram_copt
		position = 1
		provinces_to_highlight = {
			owned_by = TUR
			has_manpower_building_trigger = yes
		}
		trigger = {
			calc_true_if = {
				amount = 5
				all_province = {
					has_manpower_building_trigger = yes
					num_of_times_improved_by_owner = 5
				}	
			}
		}
		effect = {
			add_country_modifier = {
				name = ME_TUR_conscription_center
				duration = 1825
			}
		}
	}

	RAM_art_war = {
		icon = me_ram_copt
		position = 2
		required_missions = { RAM_War_Time_Policies }
		trigger = {
			custom_trigger_tooltip = {
				tooltip = ME_TUR_won_25_battles
				check_variable = {
					which = ME_TUR_roman_facade_battles_won_variable
					value = 25
				}
			}
		}
		effect = {
			add_years_of_income = 2
		}
	}

	RAM_Fishing_Off = {
		icon = me_ram_copt
		position = 3
		required_missions = { 
			RAM_art_war
			RAM_Council_Fool
		}
		trigger = {
			if = {
				limit = {
				  	emperor = {
						num_of_owned_provinces_with = {
							value = 25
							is_part_of_hre = yes
						}
					}
				}
				emperor = {
					num_of_owned_provinces_with = {
						value = 15
						is_part_of_hre = yes
						controlled_by = TUR
					}
				}
			}
			else_if = {
				limit = {
					emperor = {
						num_of_owned_provinces_with = {
							value = 14
					  		is_part_of_hre = yes
						}
					}
				}
				emperor = {
					num_of_owned_provinces_with = {
						value = 10
						is_part_of_hre = yes
						controlled_by = TUR
					}
				}
			}
			else_if = {
				limit = {
				  	emperor = {
						num_of_owned_provinces_with = {
					 		value = 5
							is_part_of_hre = yes
						}
					}
				}
				emperor = {
					num_of_owned_provinces_with = {
						value = 5
						is_part_of_hre = yes
						controlled_by = TUR
					}
				}
			}
			else_if = {
				limit = {
					NOT = {
						emperor = {
							num_of_owned_provinces_with = {
								value = 5
								is_part_of_hre = yes
							}
						}
					}
				}
				emperor = {
					num_of_owned_provinces_with = {
						value = 1
						is_part_of_hre = yes
						controlled_by = TUR
					}
				}
			}
			else = { always = yes }
		}
		effect = {
			custom_tooltip = ME_TUR_winning_sieges_gives_manpower_tt
			set_country_flag = ME_TUR_sieges_give_manpower
		}
	}
}

ME_Ramazan_incident_missions_5 = {
	slot = 5
	generic = no
	ai = yes
	potential = {
		tag = RAM
		has_country_flag = ME_TUR_Change_Tree
	}
	has_country_shield = yes

	RAM_Council_Fool = {
		icon = me_ram_copt
		position = 2
		required_missions = {
			RAM_War_Time_Policies
		}
		provinces_to_highlight = {
			AND = {
				owner = { is_elector = yes }
				is_capital = yes
				is_part_of_hre = yes
			}
		}
		trigger = {
			all_elector = {
				capital_scope = {
					controlled_by = TUR
				}
			}
		}
		effect = {
			every_elector = {
				limit = {
					is_in_war = {
						attacker_leader = TUR
						casus_belli = ME_Ottomans_Roman_Facade_CB
					}
				}
				add_opinion = {
					who = emperor
					modifier = ME_TUR_abandoned
				}
			}
		}
	}
}
