namespace = bng_habshi_events

country_event = { #Arrival of Habshis
	id = bng_habshi_events.1
	title = bng_habshi_events.1.t
	desc = bng_habshi_events.1.d
	picture = DIPLOMACY_eventPicture
	fire_only_once = yes

	trigger = {
		tag = BNG
		is_year = 1450
	}

	option = {
		name = bng_habshi_events.1.opt1
		add_country_modifier = {
			name = bng_habshi_influence_1
			duration = -1
		}
		add_manpower = 1.5
		custom_tooltip = BNG_HABSHI_INFLUENCES_DESC
		set_country_flag = bng_habshis_arrival
	}
}
country_event = { #Habshis request Noble titles
	id = bng_habshi_events.2
	title = bng_habshi_events.2.t
	desc = bng_habshi_events.2.d
	picture = ADVISOR_eventPicture

	trigger = {
		tag = BNG
		has_country_flag = bng_habshis_arrival
	}

	mean_time_to_happen = {
		months = 120
	}

	option = {
		name = bng_habshi_events.2.opt1
		increase_habshi_influence = yes
		add_country_modifier = {
			name = bng_habshi_landowners_modifier
			duration = 1825
		}
		add_loyalty = {
			estate = estate_nobles
			loyalty = -5
		}
		add_years_of_income = 0.1
		change_estate_land_share = {
			estate = estate_nobles
			share = -2
		}
	}
	option = {
		name = bng_habshi_events.2.opt2
		decrease_habshi_influence = yes
		add_loyalty = {
			estate = estate_nobles
			loyalty = 5
		}
		change_estate_land_share = {
			estate = estate_nobles
			share = 2
		}
	}
}
country_event = { #Habshis propose clerical seizures
	id = bng_habshi_events.3
	title = bng_habshi_events.3.t
	desc = bng_habshi_events.3.d
	picture = ADVISOR_eventPicture

	trigger = {
		tag = BNG
		has_country_flag = bng_habshis_arrival	
		OR = {
			estate_influence = {
    			estate = estate_church
  			 	influence = 50
			}
			NOT = { crown_land_share = 30 }
		}
	}

	mean_time_to_happen = {
		months = 120
	}

	option = {
		name = bng_habshi_events.3.opt1
		increase_habshi_influence = yes
		add_loyalty = {
			estate = estate_church
			loyalty = -5
		}
		add_years_of_income = 0.2
		change_estate_land_share = {
			estate = estate_church
			share = -2
		}
		add_piety = -0.1
	}
	option = {
		name = bng_habshi_events.3.opt2
		decrease_habshi_influence = yes
		add_loyalty = {
			estate = estate_church
			loyalty = 5
		}
		add_country_modifier = {
			name = bng_clerics_in_government_modifier
			duration = 1825
		}
		add_piety = 0.1
	}
	option = {
		name = bng_habshi_events.3.opt3
		highlight = yes
		trigger = { 
			estate_loyalty = {
				estate = estate_rajput
				loyalty = 60
			}
		}
		change_estate_land_share = {
			estate = estate_church
			share = -2
		}
		change_estate_land_share = {
			estate = estate_rajput
			share = 2
		}
		add_ruler_modifier = {
			name = bng_satisfied_rajputs_modifier
			duration = -1
		}
	}
}
country_event = { #Promising Habshi advisor
	id = bng_habshi_events.4
	title = bng_habshi_events.4.t
	desc = bng_habshi_events.4.d
	picture = ADVISOR_eventPicture

	trigger = {
		tag = BNG
		has_country_flag = bng_habshis_arrival	
		OR = {
			num_of_mercenaries = 1
			NOT = { has_mil_advisor = yes }
		}
	}

	mean_time_to_happen = {
		months = 120
	}

	option = {
		name = bng_habshi_events.4.opt1
		increase_habshi_influence = yes
		add_estate_loyalty = {
			estate = estate_nobles
			loyalty = -5
		}
		define_advisor = {
			type = bng_habshi_mercenary_captain_advisor
			skill = 1
			culture = bengali
			religion = sunni
		}
	}
	option = {
		name = bng_habshi_events.4.opt2
		decrease_habshi_influence = yes
		add_estate_loyalty = {
			estate = estate_nobles
			loyalty = 5
		}
		add_legitimacy = 5
	}
}
country_event = { #Habshis request military patronage
	id = bng_habshi_events.5
	title = bng_habshi_events.5.t
	desc = bng_habshi_events.5.d
	picture = ADVISOR_eventPicture

	trigger = {
		tag = BNG
		has_country_flag = bng_habshis_arrival	
		prestige = 25
	}

	mean_time_to_happen = {
		months = 120
	}

	option = {
		name = bng_habshi_events.5.opt1
		increase_habshi_influence = yes
		add_estate_loyalty = {
			estate = estate_nobles
			loyalty = -5
		}
		add_prestige = -10
		add_mil_power = 25
	}
	option = {
		name = bng_habshi_events.5.opt2
		decrease_habshi_influence = yes
		add_estate_loyalty = {
			estate = estate_nobles
			loyalty = 5
		}
	}
}
country_event = { #Habshi high command
	id = bng_habshi_events.6
	title = bng_habshi_events.6.t
	desc = bng_habshi_events.6.d
	picture = ADVISOR_eventPicture

	trigger = {
		tag = BNG
		has_country_flag = bng_habshis_arrival	
		OR = {
			had_recent_war = 10
			army_professionalism = 0.10
		}
	}

	mean_time_to_happen = {
		months = 240
	}

	option = {
		name = bng_habshi_events.6.opt1
		increase_habshi_influence = yes
		add_estate_loyalty = {
			estate = estate_nobles
			loyalty = -5
		}
		if = {
			limit = { has_estate = estate_rajput }
			add_estate_loyalty = {
				estate = estate_rajput
				loyalty = -5
			}
		}
		add_prestige = -5
		add_army_tradition = 5
	}
	option = {
		name = bng_habshi_events.6.opt2
		decrease_habshi_influence = yes
		add_estate_loyalty = {
			estate = estate_nobles
			loyalty = 5
		}
		create_general = { tradition = 40 }
	}
}
country_event = { #Habshi religious conversions
	id = bng_habshi_events.7
	title = bng_habshi_events.7.t
	desc = bng_habshi_events.7.d
	picture = ADVISOR_eventPicture

	trigger = {
		tag = BNG
		has_country_flag = bng_habshis_arrival	
		OR = {
			army_tradition = 40
			OR = {
				has_country_modifier = bng_habshi_influence_4
				has_country_modifier = bng_habshi_influence_5
				has_country_modifier = bng_habshi_influence_6
			}
		}
	}

	mean_time_to_happen = {
		months = 180
	}

	option = {
		name = bng_habshi_events.7.opt1
		increase_habshi_influence = yes
		if = {
			limit = { has_estate = estate_brahmins }
			add_estate_loyalty = {
				estate = estate_brahmins
				loyalty = -5
			}
		}
		if = {
			limit = { has_estate = estate_dhimmi }
			add_estate_loyalty = {
				estate = estate_dhimmi
				loyalty = -5
			}
		}
		add_piety = -0.1
		random_owned_province = {
			limit = { NOT = { has_owner_religion = yes } } 
			add_province_modifier = {
				name = bng_habshi_conversions_modifier
				duration = 7300
				hidden_effect = {
					remove_province_modifier = estate_brahmins_guaranteed_autonomy_mod
					remove_province_modifier = estate_dhimmi_guaranteed_autonomy_mod
				}
			}
		}
	}
	option = {
		name = bng_habshi_events.7.opt2
		decrease_habshi_influence = yes
		if = {
			limit = { has_estate = estate_brahmins }
			add_estate_loyalty = {
				estate = estate_brahmins
				loyalty = 5
			}
		}
		if = {
			limit = { has_estate = estate_dhimmi }
			add_estate_loyalty = {
				estate = estate_dhimmi
				loyalty = 5
			}
		}
		add_legitimacy = 10
		add_piety = 0.1
	}
}
country_event = { #Disaster potential
	id = bng_habshi_events.8
	title = bng_habshi_events.8.t
	desc = bng_habshi_events.8.d
	picture = ADVISOR_eventPicture
	is_triggered_only = yes

	trigger = {
		tag = BNG
		has_country_flag = bng_habshis_arrival	
		is_year = 1485
	}

	mean_time_to_happen = {
		months = 18
	}

	immediate = {
		set_country_flag = bng_habshi_coup_in_progress
	}

	option = {
		name = bng_habshi_events.8.opt1
		custom_tooltip = BNG_POTENTIAL_COUP_TT
		add_legitimacy = -30
	}
}

country_event = { #Disaster
	id = bng_habshi_events.9
	title = bng_habshi_events.9.t
	desc = bng_habshi_events.9.d
	picture = ADVISOR_eventPicture
	is_triggered_only = yes

	option = {
		name = bng_habshi_events.9.opt1
		set_country_flag = bng_habshi_rule
		custom_tooltip = BNG_HABSHI_REBELS_TT
		kill_ruler = yes
		kill_heir = yes
		define_ruler = {
			name = "Shamsuddin"
			dynasty = "Muzzafar Shah"
			adm = 2
			dip = 1
			mil = 4
			min_age = 18
			max_age = 50
			fixed = yes
			claim = 50
		}
		if = {
			limit = { has_country_modifier = bng_habshi_influence_6 }
			add_manpower = 1.5
			add_mil_power = 50
			add_adm_power = 50
			add_dip_power = 50
		}
		else_if = {
			limit = { has_country_modifier = bng_habshi_influence_5 }
			add_manpower = 1
			add_mil_power = 40
			add_adm_power = 40
			add_dip_power = 40
		}
		else_if = {
			limit = { has_country_modifier = bng_habshi_influence_4 }
			add_manpower = 1
			add_mil_power = 25
			add_adm_power = 25
			add_dip_power = 25
		}
		else_if = {
			limit = { has_country_modifier = bng_habshi_influence_3 }
			add_manpower = 0.75
			add_mil_power = 10
			add_adm_power = 10
			add_dip_power = 10
		}
		else_if = {
			limit = { has_country_modifier = bng_habshi_influence_2 }
			add_manpower = 0.5
		}
		else_if = {
			limit = { has_country_modifier = bng_habshi_influence_1 }
			add_manpower = 0.25
		}
		else = {
			add_manpower = 0.1
		}
		hidden_effect = {
			if = {
				limit = { has_country_modifier = bng_habshi_influence_6 }
				capital_scope = {
					spawn_rebels = {
						type = pretender_rebels
						leader = "Alauddin"
						leader_dynasty = "Husain Shah"
						size = 1
					}
				}
			}
			else_if = {
				limit = { has_country_modifier = bng_habshi_influence_5 }
				capital_scope = {
					spawn_rebels = {
						type = pretender_rebels
						leader = "Alauddin"
						leader_dynasty = "Husain Shah"
						size = 1
					}
				}
			}
			else_if = {
				limit = { has_country_modifier = bng_habshi_influence_4 }
				capital_scope = {
					spawn_rebels = {
						type = pretender_rebels
						leader = "Alauddin"
						leader_dynasty = "Husain Shah"
						size = 1
					}
				}
				random_owned_province = {
					spawn_rebels = {
						type = pretender_rebels
						leader = "Alauddin"
						leader_dynasty = "Husain Shah"
						size = 1
					}
				}
			}
			else_if = {
				limit = { has_country_modifier = bng_habshi_influence_3 }
				capital_scope = {
					spawn_rebels = {
						type = pretender_rebels
						leader = "Alauddin"
						leader_dynasty = "Husain Shah"
						size = 2
					}
				}
				random_owned_province = {
					spawn_rebels = {
						type = pretender_rebels
						leader = "Alauddin"
						leader_dynasty = "Husain Shah"
						size = 1
					}
				}
			}
			else_if = {
				limit = { has_country_modifier = bng_habshi_influence_2 }
				capital_scope = {
					spawn_rebels = {
						type = pretender_rebels
						leader = "Alauddin"
						leader_dynasty = "Husain Shah"
						size = 2
					}
				}
				random_owned_province = {
					spawn_rebels = {
						type = pretender_rebels
						leader = "Alauddin"
						leader_dynasty = "Husain Shah"
						size = 1
					}
				}
				random_owned_province = {
					spawn_rebels = {
						type = pretender_rebels
						leader = "Alauddin"
						leader_dynasty = "Husain Shah"
						size = 1
					}
				}
			}
			else_if = {
				limit = { has_country_modifier = bng_habshi_influence_1 }
				capital_scope = {
					spawn_rebels = {
						type = pretender_rebels
						leader = "Alauddin"
						leader_dynasty = "Husain Shah"
						size = 3
					}
				}
				random_owned_province = {
					spawn_rebels = {
						type = pretender_rebels
						leader = "Alauddin"
						leader_dynasty = "Husain Shah"
						size = 2
					}
				}
			}
			else = {
				capital_scope = {
					spawn_rebels = {
						type = pretender_rebels
						leader = "Alauddin"
						leader_dynasty = "Husain Shah"
						size = 3
					}
				}
				random_owned_province = {
					spawn_rebels = {
						type = pretender_rebels
						leader = "Alauddin"
						leader_dynasty = "Husain Shah"
						size = 2
					}
				}
				random_owned_province = {
					spawn_rebels = {
						type = pretender_rebels
						leader = "Alauddin"
						leader_dynasty = "Husain Shah"
						size = 2
					}
				}
			}
		}
	}
	option = {
		name = bng_habshi_events.9.opt2
		custom_tooltip = BNG_HABSHI_REBELS_TT
		kill_ruler = yes
		define_ruler = {
			name = "Alauddin"
			dynasty = "Husain Shah"
			adm = 6
			dip = 4
			mil = 4
			fixed = yes
			min_age = 18
			max_age = 35
			claim = 60
		}
		define_heir = {
			name = "Nasiruddin Nasrat"
			dynasty = "Husain Shah"
			age = 10
			adm = 5
			dip = 3
			mil = 2
			fixed = yes
			claim = 50
			no_consort_with_heir = yes
		}
		hidden_effect = {
			if = {
				limit = { has_country_modifier = bng_habshi_influence_1 }
				capital_scope = {
					spawn_rebels = {
						type = pretender_rebels
						leader = "Shamsuddin"
						leader_dynasty = "Muzzafar Shah"
						size = 1
					}
				}
			}
			else_if = {
				limit = { has_country_modifier = bng_habshi_influence_2 }
				capital_scope = {
					spawn_rebels = {
						type = pretender_rebels
						leader = "Shamsuddin"
						leader_dynasty = "Muzzafar Shah"
						size = 1
					}
				}
			}
			else_if = {
				limit = { has_country_modifier = bng_habshi_influence_3 }
				capital_scope = {
					spawn_rebels = {
						type = pretender_rebels
						leader = "Shamsuddin"
						leader_dynasty = "Muzzafar Shah"
						size = 1
					}
				}
				random_owned_province = {
					spawn_rebels = {
						type = pretender_rebels
						leader = "Shamsuddin"
						leader_dynasty = "Muzzafar Shah"
						size = 1
					}
				}
			}
			else_if = {
				limit = { has_country_modifier = bng_habshi_influence_4 }
				capital_scope = {
					spawn_rebels = {
						type = pretender_rebels
						leader = "Shamsuddin"
						leader_dynasty = "Muzzafar Shah"
						size = 2
					}
				}
				random_owned_province = {
					spawn_rebels = {
						type = pretender_rebels
						leader = "Shamsuddin"
						leader_dynasty = "Muzzafar Shah"
						size = 1
					}
				}
			}
			else_if = {
				limit = { has_country_modifier = bng_habshi_influence_5 }
				capital_scope = {
					spawn_rebels = {
						type = pretender_rebels
						leader = "Shamsuddin"
						leader_dynasty = "Muzzafar Shah"
						size = 2
					}
				}
				random_owned_province = {
					spawn_rebels = {
						type = pretender_rebels
						leader = "Shamsuddin"
						leader_dynasty = "Muzzafar Shah"
						size = 1
					}
				}
				random_owned_province = {
					spawn_rebels = {
						type = pretender_rebels
						leader = "Shamsuddin"
						leader_dynasty = "Muzzafar Shah"
						size = 1
					}
				}
			}
			else_if = {
				limit = { has_country_modifier = bng_habshi_influence_6 }
				capital_scope = {
					spawn_rebels = {
						type = pretender_rebels
						leader = "Shamsuddin"
						leader_dynasty = "Muzzafar Shah"
						size = 3
					}
				}
				random_owned_province = {
					spawn_rebels = {
						type = pretender_rebels
						leader = "Shamsuddin"
						leader_dynasty = "Muzzafar Shah"
						size = 2
					}
				}
			}
		}
	}
}

country_event = { #The Plot disintegrates
	id = bng_habshi_events.10
	title = bng_habshi_events.10.t
	desc = bng_habshi_events.10.d
	picture = ADVISOR_eventPicture
	is_triggered_only = yes

	trigger = {
		tag = BNG
		has_country_flag = bng_habshi_coup_in_progress
		OR = {
			has_country_modifier = bng_habshi_influence_1
			NOT = {
				OR = {
					has_country_modifier = bng_habshi_influence_1
					has_country_modifier = bng_habshi_influence_2
					has_country_modifier = bng_habshi_influence_3
					has_country_modifier = bng_habshi_influence_4
					has_country_modifier = bng_habshi_influence_5
					has_country_modifier = bng_habshi_influence_6
				}
			}
		}
	}

	mean_time_to_happen = {
		months = 6
		modifier = {
			factor = 0.8
			spymaster = 1
		}
		modifier = {
			factor = 0.8
			full_idea_group = spy_ideas
		}
	}

	immediate = {
		clear_country_flag = bng_habshis_arrival
		clear_country_flag = bng_habshi_coup_in_progress
		set_country_flag = bng_habshi_coup_foiled
	}

	option = {
		name = bng_habshi_events.10.opt1
		custom_tooltip = BNG_HABSHI_EXPELLED_TT
		add_ruler_modifier = {
			name = bng_stable_dynasty_modifier
			duration = -1
		}
		hidden_effect = {
			remove_country_modifier = bng_habshi_influence_1
			remove_country_modifier = bng_habshi_influence_2
			remove_country_modifier = bng_habshi_influence_3
			remove_country_modifier = bng_habshi_influence_4
			remove_country_modifier = bng_habshi_influence_5
			remove_country_modifier = bng_habshi_influence_6
			remove_country_modifier = bng_habshi_landowners_modifier
		}
	}
}

country_event = { #End of Disaster
	id = bng_habshi_events.11
	title = bng_habshi_events.11.t
	desc = bng_habshi_events.11.d
	picture = ADVISOR_eventPicture
	is_triggered_only = yes

	immediate = {
		clear_country_flag = bng_habshis_arrival
		clear_country_flag = bng_habshi_coup_in_progress
		remove_country_modifier = bng_habshi_influence_1
		remove_country_modifier = bng_habshi_influence_2
		remove_country_modifier = bng_habshi_influence_3
		remove_country_modifier = bng_habshi_influence_4
		remove_country_modifier = bng_habshi_influence_5
		remove_country_modifier = bng_habshi_influence_6
		remove_country_modifier = bng_habshi_landowners_modifier
		set_country_flag = bng_habshi_coup_resolved
	}
	
	option = {
		name = bng_habshi_events.11.opt1
		trigger = {
			NOT = { has_country_flag = bng_habshi_rule }
		}
		custom_tooltip = BNG_HABSHI_EXPELLED_TT
		add_stability = 1
		add_splendor = 200
		add_prestige = 20
	}
	option = {
		name = bng_habshi_events.11.opt2
		trigger = {
			has_country_flag = bng_habshi_rule 
		}
		add_stability = 1
		swap_free_idea_group = yes
		add_piety = -0.25
	}
}