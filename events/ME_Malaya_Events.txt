namespace = ME_Malaya_Events

country_event = {
	id = ME_Malaya_Events.1
	title = ME_Malaya_Events.1.t
	desc = ME_Malaya_Events.1.d
	picture = NAVAL_MILITARY_eventPicture

	fire_only_once = yes

	trigger = {
		tag = MNG
	}
	
	mean_time_to_happen = {
		months = 240
		
		modifier = {
			factor = 0.5
			is_year = 1450
		}
		
		modifier = {
			factor = 0.5
			is_year = 1455
		}
		
		modifier = {
			factor = 0.5
			is_year = 1460
		}
	}

	option = {
		name = ME_Malaya_Events.1.a

		ai_chance = { factor = 1 }

		add_years_of_income = -3
		custom_tooltip = MSA_expedition
		country_event = { id = ME_Malaya_Events.2 }
	}

	option = {
		name = ME_Malaya_Events.1.b

		ai_chance = { factor = 0 }
	}
}

country_event = {
	id = ME_Malaya_Events.2
	title = ME_Malaya_Events.2.t
	desc = ME_Malaya_Events.2.d
	picture = NAVAL_MILITARY_eventPicture

	is_triggered_only = yes
	major = yes
	major_trigger = {
		capital_scope = {
			continent = asia
		}
	}

	option = {
		name = ME_Malaya_Events.2.a

		ai_chance = { factor = 1 }

		hidden_effect = {
			save_global_event_target_as = MSA_china_target
		}
		custom_tooltip = MSA_expedition
		hidden_effect = {
			#Below is a large queue of areas at which the fleet arrives
			random_list = { #random list to decide how 'aggressive' the fleet will be towards natives
				20 = { } #no 'captures' guaranteed
				50 = { set_global_flag = MSA_fleet_one }
				25 = { set_global_flag = MSA_fleet_two }
				5 = { set_global_flag = MSA_fleet_three }
			}
			luzon_area = {
				MSA_start_expedition = { delay = 45 }
			}
			southern_luzon_area = {
				MSA_start_expedition = { delay = 45 }
			}
			visayas_area = {
				MSA_start_expedition = { delay = 60 }
			}
			west_mindanao_area = {
				MSA_start_expedition = { delay = 75 }
			}
			mindanao_area = {
				MSA_start_expedition = { delay = 90 }
			}
			brunei_area = { #likely to be Brunei
				MSA_start_expedition = { delay = 60 }
			}
			palawan_area = { #sulu
				MSA_start_expedition = { delay = 90 }
			}
			kalimantan_area = { #Sambas
				MSA_start_expedition = { delay = 90 }
			}
			sabah_area = { #noone
				MSA_start_expedition = { delay = 120 }
			}
			kutai_area = { #kutai and berau
				MSA_start_expedition = { delay = 120 }
			}
			banjar_area = { #Banjar
				MSA_start_expedition = { delay = 90 }
			}
			johor_area = { #noone
				MSA_start_expedition = { delay = 135 }
			}
			malaya_area = { #Pahang, Kelantan
				MSA_start_expedition = { delay = 150 }
			}
			malacca_area = { #Malacca
				MSA_start_expedition = { delay = 150 }
			}
			central_sumatra_area = { #Siak Deli
				MSA_start_expedition = { delay = 150 }
			}
			jambi_area = { #Jambi
				MSA_start_expedition = { delay = 150 }
			}
			south_sumatra_area = { #Palembang
				MSA_start_expedition = { delay = 180 }
			}
			banten_area = { #Sunda
				MSA_start_expedition = { delay = 180 }
			}
			north_malaya_area = { #Kedah Pattani
				MSA_start_expedition = { delay = 195 }
			}
			north_sumatra_area = { #Aceh, Pasai
				MSA_start_expedition = { delay = 195 }
			}
			west_java_area = { #noone
				MSA_start_expedition = { delay = 210 }
			}
			central_java_area = { #noone
				MSA_start_expedition = { delay = 210 }
			}
			batak_area = { #Barus
				MSA_start_expedition = { delay = 225 }
			}
			minangkabau_area = { #Pagarruyung, Indrapuri
				MSA_start_expedition = { delay = 240 }
			}
			surabaya_area = { #Majapahit
				MSA_start_expedition = { delay = 240 }
			}
			lesser_sunda_islands_area = { #Bali
				MSA_start_expedition = { delay = 270 }
			}
			east_java_area = { #noone
				MSA_start_expedition = { delay = 270 }
			}
			makassar_area = { #Bone and Makassar
				MSA_start_expedition = { delay = 270 }
			}
			south_sulawesi_area = { #Buton and Luwu
				MSA_start_expedition = { delay = 285 }
			}
			spice_islands_area = { #Ternate and Tidore #perhaps remove this idk
				MSA_start_expedition = { delay = 330 }
			}
		}
	}
}

country_event = {
	id = ME_Malaya_Events.3
	title = ME_Malaya_Events.3.t
	desc = ME_Malaya_Events.3.d
	picture = NAVAL_MILITARY_eventPicture

	is_triggered_only = yes

	trigger = {
		NOT = { has_country_flag = MSA_chinese_expedition_in_tag }
	}

	immediate = {
		hidden_effect = {
			set_country_flag = MSA_chinese_expedition_in_tag
			set_variable = {
				which = Malaya_china_var
				value = 50
			}
			set_variable = {
				which = MSA_events_left #When this event goes negative, you will get an event to dismiss the chinese or to urge them to stay for extra events
				value = 5
			}
		}
	}

	option = {
		name = ME_Malaya_Events.3.a

		MSA_change_china_loyalty = { value = 20 }
	}

	option = {
		name = ME_Malaya_Events.3.b

		MSA_change_china_loyalty = { value = 0 }
	}

	option = {
		name = ME_Malaya_Events.3.c

		MSA_change_china_loyalty = { value = -20 }
	}

	after = {
		set_country_flag = MSA_need_to_start_event_chain #I directly triggered the event controller at first, but it broke randomness.
	}
}

country_event = {
	id = ME_Malaya_Events.4
	title = ME_Malaya_Events.4.t #Hidden Event Controller, fires the events for Chinese Expedition
	desc = ME_Malaya_Events.4.d
	picture = RELIGIOUS_WARS_eventPicture

	hidden = yes
	is_triggered_only = yes

	trigger = {
		has_country_flag = MSA_chinese_expedition_in_tag
	}

	immediate = {
		hidden_effect = {
			clr_country_flag = MSA_timer #this flag is used in event .5 for fallback in case the delayed event doesn't work.
			if = {
				limit = {
					NOT = {
						check_variable = {
							which = MSA_events_left
							value = 0
						}
					}
				}
				country_event = { id = ME_Malaya_Events.6 }
			}
			else_if = {
				limit = {
					has_reform = pirate_republic_reform
					always = no
				}
				country_event = { id = ME_Malaya_Events.7 } #Chinese demand expulsion of pirates
			}
			else_if = {
				limit = {
					has_country_flag = MSA_neighbor_of_pirate
					always = no
				}
				country_event = { id = ME_Malaya_Events.8 } #The Pirates in .7 have refused, request military intervention
				clr_country_flag = MSA_neighbor_of_pirate
			}
			else = {
				MSA_fire_event = yes #The Logic is defined in the scripted effect file for ease of use
			}
		}
	}

	option = {
		name = ME_Malaya_Events.3.a
	}

	after = {
		set_country_flag = MSA_timer
		change_variable = {
			which = MSA_events_left
			value = -1
		}
		country_event = { id = ME_Malaya_Events.4 days = 90 random = 60 } #Event Controller
	}
}

country_event = {
	id = ME_Malaya_Events.5
	title = ME_Malaya_Events.5.t #Hidden Fallback for event four
	desc = ME_Malaya_Events.5.d
	picture = RELIGIOUS_WARS_eventPicture

	hidden = yes
	is_triggered_only = yes

	trigger = {
		had_country_flag = {
			flag = MSA_timer
			days = 360
		}
	}

	immediate = {
		hidden_effect = {
			country_event = { id = ME_Malaya_Events.4 }
		}
	}

	option = {
		name = ME_Malaya_Events.3.a
	}
}

country_event = {
	id = ME_Malaya_Events.6
	title = ME_Malaya_Events.6.t #The Chinese want to depart (but you may stop them once!)
	desc = ME_Malaya_Events.6.d
	picture = COURT_eventPicture

	is_triggered_only = yes

	option = {
		name = ME_Malaya_Events.6.a #farewell

		MSA_the_end = yes
	}

	option = {
		name = ME_Malaya_Events.6.b #noo, please stay!

		trigger = {
			NOT = { has_country_flag = MSA_begged_to_stay }
		}

		custom_tooltip = MSA_the_chinese_will_stay
		hidden_effect = {
			change_variable = {
				which = MSA_events_left
				value = 5
			}
			set_country_flag = MSA_timer
			change_variable = {
				which = MSA_events_left
				value = -1
			}
			country_event = { id = ME_Malaya_Events.4 days = 90 random = 60 } #Event Controller
		}
		set_country_flag = MSA_begged_to_stay
	}
}

country_event = {
	id = ME_Malaya_Events.7
	title = ME_Malaya_Events.7.t #Cease and Desist
	desc = ME_Malaya_Events.7.d
	picture = RELIGIOUS_WARS_eventPicture

	is_triggered_only = yes
	major = yes
	major_trigger = {
		has_country_flag = MSA_interest
	}

	option = {
		name = ME_Malaya_Events.7.a #farewell

		MSA_insulting_bonus = { }
		custom_tooltip = MSA_our_neighboring_countries
		hidden_effect = {
			every_country = {
				limit = {
					NOT = {
						border_distance = {
							who = ROOT
							distance = 100
						}
					}
				}
				set_country_flag = MSA_neighbor_of_pirate
			}
		}
	}

	option = {
		name = ME_Malaya_Events.7.b #farewell

		change_government = monarchy
		add_government_reform = feudalism_reform
		#TODO: Special Subject Type?
	}
}

country_event = {
	id = ME_Malaya_Events.8
	title = ME_Malaya_Events.8.t #A Call to Arms
	desc = ME_Malaya_Events.8.d
	picture = RELIGIOUS_WARS_eventPicture

	is_triggered_only = yes
	major = yes
	major_trigger = {
		NOT = {
			border_distance = {
				who = FROM
				distance = 100
			}
		}
		has_reform = pirate_republic_reform
	}

	option = {
		name = ME_Malaya_Events.8.a #farewell

		MSA_change_china_loyalty = { value = 10 }
	}

	option = {
		name = ME_Malaya_Events.8.b #farewell

		MSA_change_china_loyalty = { value = 0 }
		custom_tooltip = MSA_gain_cb_to_install
	}

	option = {
		name = ME_Malaya_Events.8.c #farewell

		MSA_change_china_loyalty = { value = -10 }
	}
}

country_event = {
	id = ME_Malaya_Events.9
	title = ME_Malaya_Events.9.t #Capture
	desc = ME_Malaya_Events.9.d
	picture = RELIGIOUS_WARS_eventPicture

	is_triggered_only = yes

	option = {
		name = ME_Malaya_Events.9.a #farewell

		custom_tooltip = MSA_is_taken_into_custody
		country_event = { id = ME_Malaya_Events.10 }
	}

	option = {
		name = ME_Malaya_Events.9.b #farewell

		add_stability = -1
		add_yearly_manpower = -1
	}
}

country_event = {
	id = ME_Malaya_Events.10
	title = ME_Malaya_Events.10.t #Capture
	desc = ME_Malaya_Events.10.d
	picture = RELIGIOUS_WARS_eventPicture

	is_triggered_only = yes
	major = yes
	major_trigger = {
		has_country_flag = MSA_interest
	}

	option = {
		name = ME_Malaya_Events.10.a #farewell

		#TODO Special Subject?
		custom_tooltip = MSA_is_taken_into_custody
		event_target:MSA_china_target = {
			country_event = { id = ME_Malaya_Events.11 } #appointing a viceroy
			hidden_effect = {
				country_event = { id = ME_Malaya_Events.12 days = 730 }
			}
		}
	}
}

country_event = {
	id = ME_Malaya_Events.11
	title = ME_Malaya_Events.11.t #Appoint a Viceroy
	desc = ME_Malaya_Events.11.d
	picture = RELIGIOUS_WARS_eventPicture

	is_triggered_only = yes
	major = yes
	major_trigger = {
		tag = event_target:receiver_of_major_popup
	}

	immediate = {
		hidden_effect = {
			FROM = { save_event_target_as = receiver_of_major_popup }
		}
	}

	option = {
		name = ME_Malaya_Events.11.a #farewell
	}

	option = {
		name = ME_Malaya_Events.11.b #farewell

		FROM = {
			define_ruler = {
				culture = ROOT
				religion = ROOT
				hide_skills = yes
				age = 30
			}
		}
	}
}

country_event = {
	id = ME_Malaya_Events.12
	title = ME_Malaya_Events.12.t #Deciding the Fate
	desc = ME_Malaya_Events.12.d
	picture = RELIGIOUS_WARS_eventPicture

	is_triggered_only = yes
	major = yes
	major_trigger = {
		tag = event_target:receiver_of_major_popup
	}

	immediate = {
		hidden_effect = {
			FROM = { save_event_target_as = receiver_of_major_popup }
		}
	}

	option = {
		name = ME_Malaya_Events.12.a #farewell

		FROM = {
			set_ruler = MSA_ruler_of_@FROM
		}
	}

	option = {
		name = ME_Malaya_Events.12.b #farewell
	}
}

country_event = {
	id = ME_Malaya_Events.13
	title = ME_Malaya_Events.13.t #Fate of [From.GetName]
	desc = ME_Malaya_Events.13.d
	picture = RELIGIOUS_WARS_eventPicture

	is_triggered_only = yes
	major = yes
	major_trigger = {
		tag = event_target:receiver_of_major_popup
	}

	immediate = {
		hidden_effect = {
			FROM = { save_event_target_as = receiver_of_major_popup }
		}
	}

	option = {
		name = ME_Malaya_Events.13.a #farewell

		FROM = {
			set_ruler = MSA_ruler_of_@FROM
		}
	}

	option = {
		name = ME_Malaya_Events.13.b #farewell
	}
}

country_event = {
	id = ME_Malaya_Events.14
	title = ME_Malaya_Events.15.t #hidden event to set a random flag (because randomness in eu4 is screwed up!)
	desc = ME_Malaya_Events.13.d
	picture = RELIGIOUS_WARS_eventPicture

	is_triggered_only = yes
	hidden = yes

	immediate = {
		#HERE WAS A RANDOM LIST UNTIL I DETERMINED THE SEED IS NOT RANDOM >:(
	}

	option = {
		name = ME_Malaya_Events.13.a #farewell

		ai_chance = {
			factor = 0.2
		}

		set_country_flag = MSA_against_china
	}

	option = {
		name = ME_Malaya_Events.13.b #farewell

		ai_chance = {
			factor = 0.6
		}
	}

	option = {
		name = ME_Malaya_Events.13.c #farewell

		ai_chance = {
			factor = 0.2
		}

		set_country_flag = MSA_with_china
	}
}

country_event = {
	id = ME_Malaya_Events.15
	title = ME_Malaya_Events.15.t #hidden event to begin the event chain (if I use the event fired by china, then randomness will break)
	desc = ME_Malaya_Events.13.d
	picture = RELIGIOUS_WARS_eventPicture

	hidden = yes

	trigger = {
		has_country_flag = MSA_need_to_start_event_chain
	}

	mean_time_to_happen = {
		months = 3
	}

	option = {
		name = ME_Malaya_Events.13.a #farewell

		ai_chance = {
			factor = 1
		}

		clr_country_flag = MSA_need_to_start_event_chain
		set_country_flag = MSA_timer
		change_variable = {
			which = MSA_events_left
			value = -1
		}
		country_event = { id = ME_Malaya_Events.4 days = 90 random = 60 } #Event Controller
	}

}

#25 Flavor Events

country_event = {
	id = ME_Malaya_Events.20
	title = ME_Malaya_Events.20.t #Extradition
	desc = ME_Malaya_Events.20.d
	picture = COURT_eventPicture

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			random_province = {
				limit = {
					culture_group = east_asian
				}
				save_event_target_as = MSA_origin_province
			}
			random_list = {
				33 = { set_country_flag = MSA_treasurer }
				33 = { set_country_flag = MSA_spymaster }
				33 = { } #engineer
			}
		}
	}

	option = {
		name = ME_Malaya_Events.20.a #who are they?

		ai_chance = {
			factor = 1
		}

		MSA_change_china_loyalty = { value = -5 }
		add_prestige_or_monarch_power = { amount = 10 }
	}

	option = {
		name = ME_Malaya_Events.20.b #Of course.

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_with_china
			}
		}

		MSA_change_china_loyalty = { value = 10 }
	}

	option = {
		name = ME_Malaya_Events.20.c #skilled minister you say...?

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_against_china
			}
		}

		MSA_change_china_loyalty = { value = -20 }
		if = {
			limit = {
				has_country_flag = MSA_treasurer
			}
			define_foreign_advisor = {
				type = treasurer
				skill = 2
				culture = event_target:MSA_origin_province
				religion = event_target:MSA_origin_province
				cost_multiplier = 0.5
			}
		}
		else_if = {
			limit = {
				has_country_flag = MSA_spymaster
			}
			define_foreign_advisor = {
				type = spymaster
				skill = 2
				culture = event_target:MSA_origin_province
				religion = event_target:MSA_origin_province
				cost_multiplier = 0.5
			}
		}
		else = {
			define_foreign_advisor = {
				type = fortification_expert
				skill = 2
				culture = event_target:MSA_origin_province
				religion = event_target:MSA_origin_province
				cost_multiplier = 0.5
			}
		}
	}
	after = {
		clr_country_flag = MSA_spymaster
		clr_country_flag = MSA_treasurer
	}
}

country_event = {
	id = ME_Malaya_Events.21
	title = ME_Malaya_Events.21.t #Scandal at the Court
	desc = ME_Malaya_Events.21.d
	picture = BATTLE_eventPicture

	is_triggered_only = yes

	option = {
		name = ME_Malaya_Events.21.a #take the blame

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_with_china
			}
		}

		reduce_stability_or_adm_power = yes
	}

	option = {
		name = ME_Malaya_Events.21.b #escape goat

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_against_china
			}
		}

		add_prestige = -10
		MSA_change_china_loyalty = { value = -15 }
	}
}

country_event = {
	id = ME_Malaya_Events.22
	title = ME_Malaya_Events.22.t #Desecration of a Holy Site
	desc = ME_Malaya_Events.22.d
	picture = RELIGIOUS_WARS_eventPicture

	is_triggered_only = yes

	option = {
		name = ME_Malaya_Events.22.a #It's fine...

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_with_china
			}
		}

		MSA_change_china_loyalty = { value = 10 }
		add_country_modifier = {
			name = MSA_religion_not_respected
			duration = 1825
		}
	}

	option = {
		name = ME_Malaya_Events.22.b #It happens.

		ai_chance = {
			factor = 1
		}

		add_prestige = -5
	}

	option = {
		name = ME_Malaya_Events.22.c #THEY DID WHAT?

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_against_china
			}
		}

		MSA_change_china_loyalty = { value = -5 }
		add_country_modifier = {
			name = MSA_religion_respected
			duration = 3650
		}
	}
}

country_event = {
	id = ME_Malaya_Events.23
	title = ME_Malaya_Events.23.t #Exotic Animals
	desc = ME_Malaya_Events.23.d
	picture = COURT_eventPicture

	is_triggered_only = yes

	option = {
		name = ME_Malaya_Events.23.a #Spare no expenses, send the animals to china!.

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_with_china
			}
		}

		MSA_change_china_loyalty = { value = 15 }
		add_years_of_income = -1
	}

	option = {
		name = ME_Malaya_Events.23.b #Let them see!

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_with_china
			}
		}

		MSA_change_china_loyalty = { value = 5 }
		add_prestige_or_monarch_power = { amount = 10 }
	}

	option = {
		name = ME_Malaya_Events.23.c #Our animal are ours, not theirs

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_against_china
			}
		}
	}
}

country_event = {
	id = ME_Malaya_Events.24
	title = ME_Malaya_Events.24.t #Drunken Sailors
	desc = ME_Malaya_Events.24.d
	picture = NAVAL_MILITARY_eventPicture

	is_triggered_only = yes

	option = {
		name = ME_Malaya_Events.24.a #We will not tolerate this

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_against_china
			}
		}

		MSA_change_china_loyalty = { value = -5 }
		add_power_projection = {
			type = mission_rewards_power_projection
			amount = 5
		}
	}

	option = {
		name = ME_Malaya_Events.24.b #Their supervisors know

		ai_chance = {
			factor = 1
		}

		add_dip_power = 10
	}

	option = {
		name = ME_Malaya_Events.24.c #Pretend as if nothing had happened

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_with_china
			}
		}

		capital_scope = {
			add_unrest = 3
		}
		MSA_change_china_loyalty = { value = 5 }
	}
}

country_event = {
	id = ME_Malaya_Events.25
	title = ME_Malaya_Events.25.t #Religious Idol
	desc = ME_Malaya_Events.25.d
	picture = NAVAL_MILITARY_eventPicture

	is_triggered_only = yes

	option = {
		name = ME_Malaya_Events.25.a #We will not tolerate this!

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_against_china
			}
		}

		add_estate_loyalty = {
			estate = estate_church
			loyalty = 5
		}
		MSA_change_china_loyalty = { value = -5 }
	}

	option = {
		name = ME_Malaya_Events.25.b #The idol will bless them.

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_with_china
			}
		}

		add_estate_loyalty = {
			estate = estate_church
			loyalty = -10
		}
		MSA_change_china_loyalty = { value = 5 }
	}
}

country_event = {
	id = ME_Malaya_Events.26
	title = ME_Malaya_Events.26.t #Exploitative Costs
	desc = ME_Malaya_Events.26.d
	picture = BURGHER_ESTATE_eventPicture

	is_triggered_only = yes

	option = {
		name = ME_Malaya_Events.26.a #Free Trade!

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_against_china
			}
		}

		add_estate_loyalty = {
			estate = estate_burghers
			loyalty = 10
		}
		add_country_modifier = {
			name = MSA_free_trade
			duration = 3650
		}
		MSA_change_china_loyalty = { value = -10 }
	}

	option = {
		name = ME_Malaya_Events.26.b #Force the merchants

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_with_china
			}
		}

		add_estate_loyalty = {
			estate = estate_burghers
			loyalty = -10
		}
		MSA_change_china_loyalty = { value = 10 }
	}

	option = {
		name = ME_Malaya_Events.26.c #We can't do anything.

		ai_chance = {
			factor = 1
		}

		add_mercantilism = 2
	}
}

country_event = {
	id = ME_Malaya_Events.27
	title = ME_Malaya_Events.27.t #Nobles are worried
	desc = ME_Malaya_Events.27.d
	picture = NOBLE_ESTATE_eventPicture

	is_triggered_only = yes

	option = {
		name = ME_Malaya_Events.27.a #They might be right.

		ai_chance = {
			factor = 0
		}

		if = {
			limit = {
				check_variable = {
					which = Malaya_china_var
					value = 50
				}
			}
			MSA_change_china_loyalty = { value = -10 }
		}
		else = {
			MSA_change_china_loyalty = { value = 10 }
		}
	}

	option = {
		name = ME_Malaya_Events.27.b #I rule, not the nobles.

		ai_chance = {
			factor = 1
		}

		add_estate_loyalty = {
			estate = estate_nobles
			loyalty = -10
		}
		if = {
			limit = {
				check_variable = {
					which = Malaya_china_var
					value = 50
				}
			}
			MSA_change_china_loyalty = { value = 10 }
		}
		else = {
			MSA_change_china_loyalty = { value = -10 }
		}
	}
}

country_event = {
	id = ME_Malaya_Events.28
	title = ME_Malaya_Events.28.t #Translator’s Dilemma
	desc = ME_Malaya_Events.28.d
	picture = NAVAL_MILITARY_eventPicture

	is_triggered_only = yes

	option = {
		name = ME_Malaya_Events.28.a #Universal Language

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_with_china
			}
		}

		MSA_change_china_loyalty = { value = 5 }
	}

	option = {
		name = ME_Malaya_Events.28.b #Wait

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_against_china
			}
		}

		add_legitimacy = -10
	}

	option = {
		name = ME_Malaya_Events.28.c #Find a new translator

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_with_china
			}
		}

		add_years_of_income = -0.25
		MSA_change_china_loyalty = { value = 15 }
	}
}

country_event = {
	id = ME_Malaya_Events.29
	title = ME_Malaya_Events.29.t #Local Dislike
	desc = ME_Malaya_Events.29.d
	picture = STREET_SPEECH_eventPicture

	is_triggered_only = yes

	option = {
		name = ME_Malaya_Events.29.a #It is unwarranted

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_with_china
			}
		}

		MSA_change_china_loyalty = { value = 5 }
		capital_scope = { add_unrest = 3 }
	}

	option = {
		name = ME_Malaya_Events.29.b #Find a new translator

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_against_china
			}
		}

		capital_scope = {
			if = {
				limit = {
					has_province_modifier = MSA_lowered_taxes
				}
				extend_province_modifier = {
					name = MSA_lowered_taxes
					duration = 365
				}
			}
			else = {
				add_province_modifier = {
					name = MSA_lowered_taxes
					duration = 1825
				}
			}
		}
		MSA_change_china_loyalty = { value = -5 }
	}
}

country_event = {
	id = ME_Malaya_Events.30
	title = ME_Malaya_Events.30.t #Map Sharing
	desc = ME_Malaya_Events.30.d
	picture = BATTLE_eventPicture

	is_triggered_only = yes

	option = {
		name = ME_Malaya_Events.30.a #State secrets.

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_against_china
			}
		}

		add_navy_tradition = 10
	}

	option = {
		name = ME_Malaya_Events.30.b #Share all maps

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_with_china
			}
		}

		MSA_change_china_loyalty = { value = 15 }
		add_navy_tradition = -10
	}

	option = {
		name = ME_Malaya_Events.30.c #Share some of the maps

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_with_china
			}
		}

		MSA_change_china_loyalty = { value = 5 }
	}
}

country_event = {
	id = ME_Malaya_Events.31
	title = ME_Malaya_Events.31.t #Impressment
	desc = ME_Malaya_Events.31.d
	picture = BATTLE_eventPicture

	is_triggered_only = yes

	option = {
		name = ME_Malaya_Events.31.a #How about no?

		ai_chance = {
			factor = 1
		}

		add_army_tradition = 5
	}

	option = {
		name = ME_Malaya_Events.31.b #Impressive.

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_with_china
			}
		}

		add_navy_tradition = 10
		add_yearly_sailors = -2
		MSA_change_china_loyalty = { value = 10 }
	}

	option = {
		name = ME_Malaya_Events.31.c #Let them even use our ships!

		ai_chance = {
			factor = 1
			modifier = {
				factor = 3
				has_country_flag = MSA_with_china
			}
		}

		add_yearly_sailors = -3
		add_years_of_income = -0.5
		add_country_modifier = {
			name = MSA_treasure_fleet
			duration = 9125
		}
		MSA_change_china_loyalty = { value = 20 }
	}

	option = {
		name = ME_Malaya_Events.31.e #Jail them.

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_against_china
			}
		}

		MSA_change_china_loyalty = { value = -15 }
	}
}

country_event = {
	id = ME_Malaya_Events.32
	title = ME_Malaya_Events.32.t #Displeased by Quality of Tribute
	desc = ME_Malaya_Events.32.d
	picture = COURT_eventPicture

	is_triggered_only = yes

	option = {
		name = ME_Malaya_Events.32.a #They are looking for a fight.

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_against_china
			}
		}

		MSA_change_china_loyalty = { value = -5 }
	}

	option = {
		name = ME_Malaya_Events.32.b #Increase Funds

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_with_china
			}
		}

		add_years_of_income = -0.5
		MSA_change_china_loyalty = { value = 10 }
	}
}

country_event = {
	id = ME_Malaya_Events.33
	title = ME_Malaya_Events.33.t #Hospitality Rewarded
	desc = ME_Malaya_Events.33.d
	picture = COURT_eventPicture

	is_triggered_only = yes

	option = {
		name = ME_Malaya_Events.33.a #Thanks

		highlight = yes

		trigger = {
			check_variable = {
				which = Malaya_china_var
				value = 80
			}
		}

		ai_chance = {
			factor = 1
		}

		add_years_of_income = 1
		add_prestige_or_monarch_power = { amount = 10 }
	}

	option = {
		name = ME_Malaya_Events.33.b #Is this really all you can do?

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_against_china
			}
		}

		MSA_change_china_loyalty = { value = -10 }
	}

	option = {
		name = ME_Malaya_Events.33.c #Keep it.

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_with_china
			}
		}

		MSA_change_china_loyalty = { value = 5 }
	}
}

country_event = {
	id = ME_Malaya_Events.34
	title = ME_Malaya_Events.34.t #Powerful Garrison
	desc = ME_Malaya_Events.34.d
	picture = BATTLE_eventPicture

	is_triggered_only = yes

	option = {
		name = ME_Malaya_Events.34.a #Impose Restrictions

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_against_china
			}
		}

		MSA_change_china_loyalty = { value = -10 }
	}

	option = {
		name = ME_Malaya_Events.34.b #It is a form of defence

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_with_china
			}
		}

		add_country_modifier = {
			name = MSA_form_of_defence
			duration = 3650
		}
		MSA_change_china_loyalty = { value = 5 }
	}
}

country_event = {
	id = ME_Malaya_Events.35
	title = ME_Malaya_Events.35.t #Lover Affair
	desc = ME_Malaya_Events.35.d
	picture = RELIGIOUS_WARS_eventPicture

	is_triggered_only = yes

	option = {
		name = ME_Malaya_Events.35.a #Commoner with a princess? impossible.

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_against_china
			}
		}

		MSA_change_china_loyalty = { value = -5 }
	}

	option = {
		name = ME_Malaya_Events.35.b #Love knows no bounds

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_with_china
			}
		}

		#Lover of chinese culture in court modifier?
		add_prestige = -25
		MSA_change_china_loyalty = { value = 10 }
	}
}

country_event = {
	id = ME_Malaya_Events.36
	title = ME_Malaya_Events.36.t #Foreign Drill Master
	desc = ME_Malaya_Events.36.d
	picture = BATTLE_eventPicture

	is_triggered_only = yes

	option = {
		name = ME_Malaya_Events.36.a #You know nothing.

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_against_china
			}
		}

		add_army_tradition = 5
		MSA_change_china_loyalty = { value = -10 }
	}

	option = {
		name = ME_Malaya_Events.36.b #Absolutely!

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_with_china
			}
		}

		add_years_of_income = -1
		if = {
			limit = {
				has_dlc = "Cradle of Civilization"
			}
			add_army_professionalism = 0.025
		}
		add_mil_power = 50
		add_army_tradition = -5
		MSA_change_china_loyalty = { value = 10 }
	}
}

country_event = {
	id = ME_Malaya_Events.37
	title = ME_Malaya_Events.37.t #Chinese Gift Us their Porcelain
	desc = ME_Malaya_Events.37.d
	picture = COURT_eventPicture

	is_triggered_only = yes

	option = {
		name = ME_Malaya_Events.37.a #Not as good as it is said.

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_against_china
			}
		}

		MSA_change_china_loyalty = { value = -10 }
		event_target:MSA_china_target = {
			reverse_add_casus_belli = {
				target = ROOT
				type = cb_insult
				months = 12
			}
		}
	}

	option = {
		name = ME_Malaya_Events.37.b #Splendid

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_with_china
			}
		}

		MSA_change_china_loyalty = { value = 5 }
	}
}

country_event = {
	id = ME_Malaya_Events.38
	title = ME_Malaya_Events.38.t #Chinese Gift Us their Silk
	desc = ME_Malaya_Events.38.d
	picture = COURT_eventPicture

	is_triggered_only = yes

	option = {
		name = ME_Malaya_Events.38.a #You know nothing.

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_against_china
			}
		}

		MSA_change_china_loyalty = { value = -10 }
		event_target:MSA_china_target = {
			reverse_add_casus_belli = {
				target = ROOT
				type = cb_insult
				months = 12
			}
		}
	}

	option = {
		name = ME_Malaya_Events.38.b #Nice

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_with_china
			}
		}

		MSA_change_china_loyalty = { value = 5 }
	}

	option = {
		name = ME_Malaya_Events.38.c #Fantastic!

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_with_china
			}
		}

		add_prestige_or_monarch_power = { amount = 20 }
		MSA_change_china_loyalty = { value = 15 }
	}
}

country_event = {
	id = ME_Malaya_Events.39
	title = ME_Malaya_Events.39.t #Ship repairs needed
	desc = ME_Malaya_Events.39.d
	picture = NAVAL_MILITARY_eventPicture

	is_triggered_only = yes

	option = {
		name = ME_Malaya_Events.39.a #We can't do anything.

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_against_china
			}
		}

		add_dip_power = -5
	}

	option = {
		name = ME_Malaya_Events.39.b #Expel the foreign merchants

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_with_china
			}
		}

		capital_scope = {
			add_trade_modifier = {
				who = ROOT
				duration = 3650
				power = -10
				key = MSA_giving_up_ports
			}
		}
		MSA_change_china_loyalty = { value = 5 }
	}

	option = {
		name = ME_Malaya_Events.39.c #Devote all resources to their needs.

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_with_china
			}
		}

		capital_scope = {
			add_trade_modifier = {
				who = ROOT
				duration = 3650
				power = -15
				key = MSA_giving_up_ports
			}
		}

		add_country_modifier = {
			name = MSA_losing_wealth
			duration = 3650
		}
		add_mercantilism = -1
		MSA_change_china_loyalty = { value = 15 }
	}
}

country_event = {
	id = ME_Malaya_Events.40
	title = ME_Malaya_Events.40.t #Wisdom of the Generals
	desc = ME_Malaya_Events.40.d
	picture = BATTLE_eventPicture

	is_triggered_only = yes

	option = {
		name = ME_Malaya_Events.40.a #Sure.

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_with_china
			}
		}

		add_army_tradition_or_mil_power = { amount = 15 }
		MSA_change_china_loyalty = { value = 5 }
	}

	option = {
		name = ME_Malaya_Events.40.b #We can handle this without you.

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_against_china
			}
		}

		MSA_change_china_loyalty = { value = -10 }
		add_mil_power = 25
	}
}

country_event = {
	id = ME_Malaya_Events.41
	title = ME_Malaya_Events.41.t #Wisdom of the Generals
	desc = ME_Malaya_Events.41.d
	picture = BATTLE_eventPicture

	is_triggered_only = yes

	option = {
		name = ME_Malaya_Events.41.a #Sure.

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_with_china
			}
		}

		MSA_change_china_loyalty = { value = 5 }
	}

	option = {
		name = ME_Malaya_Events.41.b #We can handle this without you.

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_against_china
			}
		}

		MSA_change_china_loyalty = { value = -5 }
	}
}

country_event = {
	id = ME_Malaya_Events.42
	title = ME_Malaya_Events.42.t #Wisdom of the Generals
	desc = ME_Malaya_Events.42.d
	picture = COURT_eventPicture

	is_triggered_only = yes

	option = {
		name = ME_Malaya_Events.42.a #Sure.

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_with_china
			}
		}

		MSA_change_china_loyalty = { value = 5 }
	}

	option = {
		name = ME_Malaya_Events.42.b #We can handle this without you.

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_against_china
			}
		}

		MSA_change_china_loyalty = { value = -5 }
	}
}

country_event = {
	id = ME_Malaya_Events.43
	title = ME_Malaya_Events.43.t #Assistance in War
	desc = ME_Malaya_Events.43.d
	picture = BATTLE_eventPicture

	is_triggered_only = yes

	option = {
		name = ME_Malaya_Events.43.a #Sure.

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_with_china
			}
		}

		create_general = { tradition = 50 }
		add_yearly_manpower = 0.5
	}

	option = {
		name = ME_Malaya_Events.43.b #We can handle this without you.

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_against_china
			}
		}

		MSA_change_china_loyalty = { value = -5 }
		add_mil_power = 10
	}
}

country_event = {
	id = ME_Malaya_Events.44
	title = ME_Malaya_Events.44.t #Peaceful ways
	desc = ME_Malaya_Events.44.d
	picture = COURT_eventPicture

	is_triggered_only = yes

	option = {
		name = ME_Malaya_Events.44.a #We were never warmongers.

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_with_china
			}
		}

		MSA_change_china_loyalty = { value = 10 }
	}

	option = {
		name = ME_Malaya_Events.44.b #Is that so?

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_country_flag = MSA_against_china
			}
		}

		add_country_modifier = {
			name = MSA_peaceful_ways
			duration = 3650
		}
	}
}

#Regular Mission Events start here
country_event = {
	id = ME_Malaya_Events.45
	title = ME_Malaya_Events.45.t #Dealing with the Beliefs
	desc = ME_Malaya_Events.45.d
	picture = RELIGIOUS_WARS_eventPicture

	is_triggered_only = yes

	option = {
		name = ME_Malaya_Events.45.a #Enforce Legalism

		ai_chance = {
			factor = 1
		}

		add_piety = 0.25
		add_country_modifier = {
			name = MSA_legalism_enforced
			duration = 9125
		}
	}

	option = {
		name = ME_Malaya_Events.45.b #We will tolerate some syncretism

		ai_chance = {
			factor = 1
		}

		add_country_modifier = {
			name = MSA_syncretism
			duration = 9125
		}
	}

	option = {
		name = ME_Malaya_Events.45.c #And those tales are true!

		ai_chance = {
			factor = 1
		}

		add_piety = -0.25
		add_country_modifier = {
			name = MSA_adhering_to_the_origins
			duration = 9125
		}
	}
}

country_event = {
	id = ME_Malaya_Events.46
	title = ME_Malaya_Events.46.t #Recording our Annals
	desc = ME_Malaya_Events.46.d
	picture = UNIVERSITY_eventPicture

	is_triggered_only = yes

	option = {
		name = ME_Malaya_Events.46.a #Mystical is our state

		ai_chance = {
			factor = 1
		}

		add_country_modifier = {
			name = MSA_low_piety
			duration = -1
		}
		set_country_flag = MSA_decision_piety
		custom_tooltip = MSA_decision_is_enabled
	}

	option = {
		name = ME_Malaya_Events.46.b #Let us write a more legalistic approach

		ai_chance = {
			factor = 1
		}

		add_country_modifier = {
			name = MSA_high_piety
			duration = -1
		}
		set_country_flag = MSA_decision_piety
		custom_tooltip = MSA_decision_is_enabled
	}
}

country_event = {
	id = ME_Malaya_Events.47
	title = ME_Malaya_Events.47.t #Pilgrims in Mecca
	desc = ME_Malaya_Events.47.d
	picture = RELIGION_eventPicture

	is_triggered_only = yes
	major = yes
	major_trigger = {
		religion_group = muslim
	}

	option = {
		name = ME_Malaya_Events.47.a

		ai_chance = {
			factor = 1
		}

		385 = {
			add_province_modifier = {
				name = MSA_pilgrims
				duration = 10950
			}
		}
		add_trust = {
			who = FROM
			value = 25
			mutual = yes
		}
	}
}

country_event = {
	id = ME_Malaya_Events.48
	title = ME_Malaya_Events.48.t #Pilgrims in Mecca
	desc = ME_Malaya_Events.48.d
	picture = RELIGION_eventPicture

	is_triggered_only = yes
	major = yes
	major_trigger = {
		tag = event_target:receiver_of_major_popup
	}

	trigger = {
		NOT = { has_country_flag = MSA_event_fired }
	}

	immediate = {
		hidden_effect = {
			set_country_flag = MSA_event_fired
			FROM = { save_event_target_as = receiver_of_major_popup }
		}
	}

	option = {
		name = ME_Malaya_Events.48.a

		ai_chance = {
			factor = 1
		}

		change_religion = FROM
		add_province_modifier = {
			name = MSA_religious_minority
			duration = 36500
		}
	}

	option = {
		name = ME_Malaya_Events.48.b

		trigger = {
			NOT = { religion_group = muslim }
		}

		ai_chance = {
			factor = 1
			modifier = {
				factor = 10
				NOT = { num_of_cities = 4 }
			}
			modifier = {
				factor = 10
				NOT = { num_of_cities = 2 }
			}
		}

		change_religion = FROM
		owner = {
			change_religion = FROM
		}

	}

	option = {
		name = ME_Malaya_Events.48.c

		trigger = {
			NOT = { religion_group = muslim }
		}

		ai_chance = {
			factor = 1
		}

		add_province_modifier = {
			name = MSA_religious_minority
			duration = 9125
		}
	}
	after = { clr_country_flag = MSA_event_fired }
}

country_event = {
	id = ME_Malaya_Events.49
	title = ME_Malaya_Events.49.t #Cantonese Malay Community
	desc = ME_Malaya_Events.49.d
	picture = SHIP_SAILING_eventPicture

	is_triggered_only = yes
	major = yes
	major_trigger = {
		capital_scope = {
			OR = {
				region = south_china_region
				region = north_china_region
			}
		}
	}

	immediate = {
		hidden_effect = {
			set_country_flag = MSA_canton_community
			set_variable = {
				which = MSA_community_size
				value = 3
			}
			667 = { #granted
				add_permanent_province_modifier = {
					name = MSA_malay_community
					duration = -1
				}
				#add_province_triggered_modifier = MSA_malay_community_triggered
			}
			668 = { #granted
				add_permanent_province_modifier = {
					name = MSA_malay_community
					duration = -1
				}
			}
			665 = { #granted
				add_permanent_province_modifier = {
					name = MSA_malay_community
					duration = -1
				}
			}
			2157 = { #1
				add_permanent_province_modifier = {
					name = MSA_malay_community
					duration = -1
				}
			}
			2158 = { #2
				add_permanent_province_modifier = {
					name = MSA_malay_community
					duration = -1
				}
			}
			2159 = { #3
				add_permanent_province_modifier = {
					name = MSA_malay_community
					duration = -1
				}
			}
		}
	}

	option = {
		name = ME_Malaya_Events.49.a

		ai_chance = {
			factor = 1
		}

		custom_tooltip = MSA_interacting
	}
}

province_event = {
	id = ME_Malaya_Events.50
	title = ME_Malaya_Events.50.t #Initial Event to Set Modifier
	desc = ME_Malaya_Events.50.d
	picture = RELIGION_eventPicture

	fire_only_once = yes
	major = yes
	major_trigger = {
		culture_group = malay
	}

	trigger = {
		province_id = 596
	}

	option = {
		name = ME_Malaya_Events.50.a

		ai_chance = {
			factor = 1
		}

		add_permanent_province_modifier = {
			name = MSA_muslim_center
			duration = -1
		}
		set_global_flag = MSA_muslim_center_flag
		hidden_effect = { save_global_event_target_as = ME_MSA_muslim_center_target }
		custom_tooltip = MSA_tooltip

		hidden_effect = {
			617 = { set_province_flag = MSA_spread_failed } #starting centers too far away
			594 = { set_province_flag = MSA_spread_failed }
			2673 = { set_province_flag = MSA_spread_failed }
		}
	}
}

country_event = {
	id = ME_Malaya_Events.51
	title = ME_Malaya_Events.51.t #Importing Spice Crops
	desc = ME_Malaya_Events.51.d
	picture = ECONOMY_eventPicture

	is_triggered_only = yes

	immediate = {
		pick_best_provinces = {
			5 = yes
			global_trigger = "
				country_or_non_sovereign_subject_holds = ROOT
				colonial_region = colonial_australia
				has_production_building_trigger = yes
			"
			scale = " higher_development_than "
			event_target_name = "Malaya_Target"
		}
	}

	option = {
		name = ME_Malaya_Events.51.a

		ai_chance = {
			factor = 1
		}

		event_target:Malaya_Target_1 = {
			change_trade_goods = spices
			add_province_modifier = {
				name = MSA_spice_introduction
				duration = 14600
			}
		}
		event_target:Malaya_Target_2 = {
			change_trade_goods = spices
			add_province_modifier = {
				name = MSA_spice_introduction
				duration = 14600
			}
		}
		event_target:Malaya_Target_3 = {
			change_trade_goods = spices
			add_province_modifier = {
				name = MSA_spice_introduction
				duration = 14600
			}
		}
		event_target:Malaya_Target_4 = {
			change_trade_goods = spices
			add_province_modifier = {
				name = MSA_spice_introduction
				duration = 14600
			}
		}
		event_target:Malaya_Target_5 = {
			change_trade_goods = spices
			add_province_modifier = {
				name = MSA_spice_introduction
				duration = 14600
			}
		}
	}

	option = {
		name = ME_Malaya_Events.51.b

		ai_chance = {
			factor = 1
		}

		add_prestige = -10
	}

	option = {
		name = ME_Malaya_Events.51.c

		ai_chance = {
			factor = 1
		}

		add_stability = -1
	}
}

country_event = {
	id = ME_Malaya_Events.52
	title = ME_Malaya_Events.52.t #Trade Deal
	desc = ME_Malaya_Events.52.d
	picture = ECONOMY_eventPicture

	is_triggered_only = yes

	option = {
		name = ME_Malaya_Events.52.a

		ai_chance = {
			factor = 1
		}

		add_years_of_income = 1
	}

	option = {
		name = ME_Malaya_Events.52.b

		ai_chance = {
			factor = 1
		}

		if = {
			limit = {
				is_expanded_mod_active = { mod = trade_goods }
			}
			add_country_modifier = {
				name = MSA_perma_burgher_slot
				duration = -1
			}
		}
		else = {
			add_estate_loyalty = {
				estate = estate_burghers
				loyalty = 25
			}
		}
		custom_tooltip = SLO_BURGHER_MANA
		hidden_effect = {
			if = {
				limit = {
					num_of_estate_privileges = {
						estate = estate_burghers
						value = 1
					}
				}
				if = {
					limit = {
						num_of_estate_privileges = {
							estate = estate_burghers
							value = 2
						}
					}
					if = {
						limit = {
							num_of_estate_privileges = {
								estate = estate_burghers
								value = 3
							}
						}
						if = {
							limit = {
								num_of_estate_privileges = {
									estate = estate_burghers
									value = 4
								}
							}
							add_dip_power = 25
						}
						add_dip_power = 25
					}
					add_dip_power = 25
				}
				add_dip_power = 25
			}
		}
	}
}

country_event = {
	id = ME_Malaya_Events.53
	title = ME_Malaya_Events.53.t #Tropical Wood - Purpose
	desc = ME_Malaya_Events.53.d
	picture = ECONOMY_eventPicture

	is_triggered_only = yes

	option = {
		name = ME_Malaya_Events.53.a

		ai_chance = {
			factor = 1
		}

		add_country_modifier = {
			name = MSA_excellent_incense
			duration = 9125
		}
	}

	option = {
		name = ME_Malaya_Events.53.b

		ai_chance = {
			factor = 1
		}

		add_country_modifier = {
			name = MSA_renowned_wood
			duration = 9125
		}
	}

	option = {
		name = ME_Malaya_Events.53.c

		ai_chance = {
			factor = 1
		}

		add_country_modifier = {
			name = MSA_shipbuilding
			duration = 9125
		}
	}
}

country_event = {
	id = ME_Malaya_Events.54
	title = ME_Malaya_Events.54.t #United in Vassalage
	desc = ME_Malaya_Events.54.d
	picture = GOOD_WITH_MONARCH_eventPicture

	is_triggered_only = yes

	major = yes
	major_trigger = {
		tag = event_target:receiver_of_major_popup
	}

	immediate = {
		hidden_effect = {
			FROM = { save_event_target_as = receiver_of_major_popup }
		}
	}

	option = {
		name = ME_Malaya_Events.54.a

		trigger = {
			is_free_or_tributary_trigger = yes
		}

		ai_chance = {
			factor = 1
		}

		hidden_effect = {
			if = {
				limit = {
					is_subject = yes
				}
				overlord = {
					ROOT = {
						grant_independence = yes
					}
				}
			}
		}
		FROM = {
			vassalize = ROOT
		}
	}

	option = {
		name = ME_Malaya_Events.54.b

		ai_chance = {
			factor = 0
		}

		add_prestige = 5
	}
}

country_event = {
	id = ME_Malaya_Events.55
	title = ME_Malaya_Events.55.t #hidden event for a european power
	desc = ME_Malaya_Events.55.d
	picture = RELIGIOUS_WARS_eventPicture

	hidden = yes
	fire_only_once = yes

	trigger = {
		has_idea_group = exploration_ideas
		exists = MSA
		MSA = {
			has_country_flag = MSA_chose_religious_tree
		}
		1361 = { has_discovered = ROOT }
		1448 = { has_discovered = ROOT }
		1460 = { has_discovered = ROOT }
		capital_scope = {
			continent = europe
		}
	}

	mean_time_to_happen = {
		months = 24
	}

	immediate = {
		hidden_effect = {
			MSA = {
				country_event = { id = ME_Malaya_Events.56 }
			}
		}
	}

	option = {
		name = ME_Malaya_Events.55.a

		ai_chance = {
			factor = 1
		}
	}
}

country_event = {
	id = ME_Malaya_Events.56
	title = ME_Malaya_Events.56.t #Incident in the Strait
	desc = ME_Malaya_Events.56.d
	picture = NAVAL_MILITARY_eventPicture

	is_triggered_only = yes

	major = yes
	major_trigger = {
		tag = event_target:receiver_of_major_popup
	}

	immediate = {
		hidden_effect = {
			set_country_flag = MSA_incident
			FROM = { save_event_target_as = receiver_of_major_popup }
		}
	}

	option = {
		name = ME_Malaya_Events.56.a

		ai_chance = {
			factor = 1
		}

		set_country_flag = MSA_europe_no
		custom_tooltip = MSA_europe_no
		clr_country_flag = MSA_europe_yes
		swap_non_generic_missions = yes
		FROM = {
			country_event = { id = ME_Malaya_Events.57 }
		}
	}

	option = {
		name = ME_Malaya_Events.56.b

		ai_chance = {
			factor = 0
		}

		set_country_flag = MSA_europe_yes
		custom_tooltip = MSA_europe_yes
		clr_country_flag = MSA_europe_no
		swap_non_generic_missions = yes
	}
}

country_event = {
	id = ME_Malaya_Events.57
	title = ME_Malaya_Events.57.t #Incident in the Strait
	desc = ME_Malaya_Events.57.d
	picture = NAVAL_MILITARY_eventPicture

	is_triggered_only = yes

	major = yes
	major_trigger = {
		tag = event_target:receiver_of_major_popup
	}

	immediate = {
		hidden_effect = {
			FROM = { save_event_target_as = receiver_of_major_popup }
		}
	}

	option = {
		name = ME_Malaya_Events.57.a

		ai_chance = {
			factor = 1
		}

		add_historical_rival = FROM
		FROM = { add_historical_rival = ROOT }
	}
}

#country_event = { Unused?
#	id = ME_Malaya_Events.58
#	title = ME_Malaya_Events.58.t #Incident in the Strait
	# desc = ME_Malaya_Events.58.d
	# picture = RELIGIOUS_WARS_eventPicture

	# is_triggered_only = yes

	# major = yes
	# major_trigger = {
		# tag = FROM
	# }

	# option = {
		# name = ME_Malaya_Events.58.a

		# ai_chance = {
			# factor = 1
		# }

	# }
# }

country_event = {
	id = ME_Malaya_Events.59
	title = ME_Malaya_Events.59.t #Religious - Muslim
	desc = ME_Malaya_Events.59.d
	picture = RELIGION_eventPicture

	trigger = {
		tag = MSA
		NOT = { has_country_flag = MSA_chose_religious_tree }
		religion_group = muslim
	}

	mean_time_to_happen = {
		months = 12
	}

	option = {
		name = ME_Malaya_Events.59.a

		ai_chance = {
			factor = 1
		}

		custom_tooltip = MSA_this_will_be_our_religious
		set_country_flag = MSA_religion_muslim
		set_country_flag = MSA_chose_religious_tree
		swap_non_generic_missions = yes
	}

	option = {
		name = ME_Malaya_Events.59.b

		ai_chance = {
			factor = 0
		}
	}
}

country_event = {
	id = ME_Malaya_Events.60
	title = ME_Malaya_Events.60.t #Religious Zeal - Hindu
	desc = ME_Malaya_Events.60.d
	picture = RELIGION_eventPicture

	trigger = {
		tag = MSA
		NOT = { has_country_flag = MSA_chose_religious_tree }
		religion = hinduism
	}

	mean_time_to_happen = {
		months = 12
	}

	option = {
		name = ME_Malaya_Events.60.a

		ai_chance = {
			factor = 1
		}

		custom_tooltip = MSA_this_will_be_our_religious
		set_country_flag = MSA_religion_hindu
		set_country_flag = MSA_chose_religious_tree
		swap_non_generic_missions = yes
	}

	option = {
		name = ME_Malaya_Events.60.b

		ai_chance = {
			factor = 0
		}
	}
}

country_event = {
	id = ME_Malaya_Events.61
	title = ME_Malaya_Events.61.t #Religious Zeal - Other
	desc = ME_Malaya_Events.61.d
	picture = RELIGION_eventPicture

	trigger = {
		always = no #for the future
		tag = MSA
		NOT = { has_country_flag = MSA_chose_religious_tree }
		NOT = {
			OR = {
				religion = hinduism
				religion_group = muslim
			}
		}
	}

	mean_time_to_happen = {
		months = 12
	}

	option = {
		name = ME_Malaya_Events.61.a

		ai_chance = {
			factor = 1
		}

		custom_tooltip = MSA_this_will_be_our_religious
		set_country_flag = MSA_religion_default
		set_country_flag = MSA_chose_religious_tree
		swap_non_generic_missions = yes
	}
}

country_event = {
	id = ME_Malaya_Events.62
	title = ME_Malaya_Events.62.t #Christianity Spread - Initial Event
	desc = ME_Malaya_Events.62.d
	picture = RELIGION_eventPicture

	fire_only_once = yes

	trigger = {
		OR = {
			had_country_flag = {
				flag = MSA_europe_yes
				days = 3650
			}
			had_country_flag = {
				flag = MSA_europe_no
				days = 9125
			}
		}
	}

	immediate = {
		hidden_effect = {
			set_country_flag = MSA_spread_of_christianity
		}
	}

	option = {
		name = ME_Malaya_Events.62.a #No!

		ai_chance = {
			factor = 1
		}

		custom_tooltip = MSA_spread_of_christianity_slow
		set_country_flag = MSA_spread_of_christianity_slow
	}

	option = {
		name = ME_Malaya_Events.62.b #Sure

		ai_chance = {
			factor = 1
		}

		custom_tooltip = MSA_spread_of_christianity_will_continue
	}
}

country_event = {
	id = ME_Malaya_Events.63
	title = ME_Malaya_Events.63.t #Christianity Spread - Pick a Province
	desc = ME_Malaya_Events.63.d
	picture = RELIGION_eventPicture

	hidden = yes

	trigger = {
		has_country_flag = MSA_spread_of_christianity
		any_owned_province = {
			NOT = { religion_group = christian }
		}
	}

	mean_time_to_happen = {
		months = 60
		modifier = {
			factor = 3
			has_country_flag = MSA_spread_of_christianity_slow
		}
	}

	immediate = {
		hidden_effect = {
			random_list = {
				80 = {
					MSA_christian_spread_animist_dharmic = yes
				}
				20 = {
					MSA_christian_spread_center = yes
				}
			}
			event_target:MSA_province = {
				province_event = { id = ME_Malaya_Events.64 }
			}
		}
	}

	option = {
		name = ME_Malaya_Events.64.a

		ai_chance = {
			factor = 1
		}
	}
}

province_event = {
	id = ME_Malaya_Events.64
	title = ME_Malaya_Events.64.t #Christianity Spread
	desc = ME_Malaya_Events.64.d
	picture = RELIGION_eventPicture

	is_triggered_only = yes

	goto = ROOT

	immediate = {
		hidden_effect = {
			random_province = {
				limit = {
					religion_group = christian
				}
				save_event_target_as = MSA_province
			}
			if = {
				limit = {
					owner = {
						any_ally = {
							capital_scope = {
								continent = europe
							}
							religion_group = christian
						}
					}
				}
				owner = {
					random_ally = {
						limit = {
							capital_scope = {
								continent = europe
							}
							religion_group = christian
						}
						save_event_target_as = MSA_province
					}
				}
			}
			else = {
				random_country = {
					limit = {
						capital_scope = {
							continent = europe
						}
						religion_group = christian
						has_idea_group = exploration_ideas
					}
					save_event_target_as = MSA_province
				}
			}
		}
	}

	option = {
		name = ME_Malaya_Events.64.a

		ai_chance = {
			factor = 1
		}

		change_religion = event_target:MSA_province
		add_province_modifier = {
			name = MSA_christian_community
			duration = -1
		}
		hidden_effect = {
			change_variable = {
				which = MSA_amount_of_christian_conversions
				value = 1
			}
		}
	}
}

province_event = {
	id = ME_Malaya_Events.65
	title = ME_Malaya_Events.65.t #The Fall of the Muslim Sultanates in India
	desc = ME_Malaya_Events.65.d
	picture = RELIGIOUS_WARS_eventPicture

	fire_only_once = yes
	major = yes
	major_trigger = {
		religion_group = muslim
		religion_group = dharmic
	}

	trigger = {
		province_id = 522
		NOT = {
			calc_true_if = {
				india_superregion = {
					owner = {
						religion_group = muslim
					}
				}
				amount = 25
			}
		}
	}

	option = {
		name = ME_Malaya_Events.65.a

		ai_chance = {
			factor = 1
		}

		custom_tooltip = MSA_spread_of_islam_will_slow_down
		set_global_flag = MSA_spread_of_islam_slowdown_flag_india
	}
}

country_event = {
	id = ME_Malaya_Events.66
	title = ME_Malaya_Events.66.t #Concessions
	desc = ME_Malaya_Events.66.d
	picture = NAVAL_MILITARY_eventPicture

	is_triggered_only = yes
	#one about 3 years of income, one about mercantilism, one about losing trade power in a province.
	option = {
		name = ME_Malaya_Events.66.a

		trigger = {
			NOT = { has_country_modifier = MSA_concession_guard }
		}

		ai_chance = {
			factor = 1
		}

		change_variable = {
			which = MSA_foreign_investment_amount
			value = 5
		}
		add_country_modifier = {
			name = MSA_concession_guard
			duration = 5475
		}
	}

	option = {
		name = ME_Malaya_Events.66.b

		trigger = {
			NOT = { has_country_modifier = MSA_concession_trade_efficiency }
		}

		change_variable = {
			which = MSA_foreign_investment_amount
			value = 5
		}
		add_country_modifier = {
			name = MSA_concession_trade_efficiency
			duration = 5475
		}
	}

	option = {
		name = ME_Malaya_Events.66.c

		ai_chance = {
			factor = 1
		}

		trigger = {
			any_ally = {
				capital_scope = {
					continent = europe
				}
			}
		}

		change_variable = {
			which = MSA_foreign_investment_amount
			value = 5
		}
		set_country_flag = MSA_trade_concession_timer
		custom_tooltip = MSA_random_partner
		tooltip = {
			1361 = {
				add_trade_modifier = {
					who = ROOT
					duration = 5475
					power = 50
					key = MSA_benefits
				}
			}
		}
		hidden_effect = {
			random_ally = {
				limit = {
					capital_scope = {
						continent = europe
					}
				}
				1361 = {
					add_trade_modifier = {
						who = PREV
						duration = 5475
						power = 50
						key = MSA_benefits
					}
				}
			}
		}
	}

	#option = {
	#	name = ME_Malaya_Events.66.e
	#
		# ai_chance = {
			# factor = 1
		# }
		# trigger = {
			# any_ally = {
				# capital_scope = {
					# continent = europe
				# }
			# }
		# }

		# change_variable = {
			# which = MSA_foreign_investment_amount
			# value = 25
		# }
		# set_country_flag = MSA_province_give_up
		# country_event = { id = ME_Malaya_Events.68 } #Province Choice
	# }

	option = {
		name = ME_Malaya_Events.66.e

		ai_chance = {
			factor = 1
		}

		trigger = {
			mercantilism = 15
		}

		change_variable = {
			which = MSA_foreign_investment_amount
			value = 5
		}
		add_mercantilism = -5
	}

	option = {
		name = ME_Malaya_Events.66.f

		ai_chance = {
			factor = 1
		}

		trigger = {
			years_of_income = 2.5
		}

		change_variable = {
			which = MSA_foreign_investment_amount
			value = 5
		}
		add_years_of_income = -2.5
	}

	# option = {
		# name = ME_Malaya_Events.66.f

		# ai_chance = {
			# factor = 1
		# }

		# trigger = {
			# any_owned_province = {
				# province_has_center_of_trade_of_level = 1
			# }
		# }

		# set_country_flag = MSA_concession_province
		# country_event = { id = ME_Malaya_Events.68 }
	# }

	option = {
		name = ME_Malaya_Events.66.g

		ai_chance = {
			factor = 1
		}
	}
}

country_event = {
	id = ME_Malaya_Events.67
	title = ME_Malaya_Events.67.t #Requests
	desc = ME_Malaya_Events.67.d
	picture = NAVAL_MILITARY_eventPicture

	is_triggered_only = yes

	option = {
		name = ME_Malaya_Events.67.a

		trigger = {
			check_variable = {
				which = MSA_foreign_investment_amount
				value = 10
			}
			OR = {
				NOT = { has_country_flag = MSA_investment_a_cooldown }
				had_country_flag = {
					flag = MSA_investment_a_cooldown
					days = 3650
				}
			}
		}

		ai_chance = {
			factor = 1
		}

		custom_tooltip = MSA_cooldown_10
		MSA_this_will_cost = { amount = 10 execute = yes }
		set_country_flag = MSA_investment_a_cooldown
		custom_tooltip = MSA_100_power_split
		hidden_effect = { #this is where the fun begins
			MSA_find_lowest_tech_effect = yes
			change_variable = {
				which = ME_Num_of_Foreign_Investments
				value = 1
			}
		}
	}

	option = {
		name = ME_Malaya_Events.67.b

		trigger = {
			check_variable = {
				which = MSA_foreign_investment_amount
				value = 10
			}
			NOT = { has_country_modifier = MSA_mercenary_investment_modifier }
		}

		custom_tooltip = MSA_cooldown_10
		MSA_this_will_cost = { amount = 10 execute = yes }
		custom_tooltip = MSA_space_lol
		add_yearly_manpower = 0.5
		add_country_modifier = {
			name = MSA_mercenary_investment_modifier
			duration = 3650
		}
		hidden_effect = {
			change_variable = {
				which = ME_Num_of_Foreign_Investments
				value = 1
			}
		}
	}

	option = {
		name = ME_Malaya_Events.67.c

		trigger = {
			check_variable = {
				which = MSA_foreign_investment_amount
				value = 15
			}
			OR = {
				NOT = { has_country_flag = MSA_investment_c_cooldown }
				had_country_flag = {
					flag = MSA_investment_c_cooldown
					days = 5475
				}
			}
			any_owned_province = {
				NOT = { trade_goods = coffee } #wtf?
			}
		}

		ai_chance = {
			factor = 1
		}

		custom_tooltip = MSA_cooldown_15
		MSA_this_will_cost = { amount = 15 }
		custom_tooltip = MSA_space_lol
		set_country_flag = MSA_coffee_choice
		custom_tooltip = MSA_coffee_choice
		tooltip = {
			add_province_modifier = {
				name = MSA_coffee
				duration = -1
			}
		}
		country_event = { id = ME_Malaya_Events.68 } #Coffee - province choice
		hidden_effect = {
			#change_variable = {
			#	which = ME_Num_of_Foreign_Investments
			#	value = 1
			#}
		}
	}

	option = {
		name = ME_Malaya_Events.67.e

		trigger = {
			check_variable = {
				which = MSA_foreign_investment_amount
				value = 5
			}
			OR = {
				NOT = { has_country_flag = MSA_investment_e_cooldown }
				had_country_flag = {
					flag = MSA_investment_e_cooldown
					days = 1825
				}
			}
		}

		ai_chance = {
			factor = 1
		}

		custom_tooltip = MSA_cooldown_5
		MSA_this_will_cost = { amount = 5 execute = yes }
		custom_tooltip = MSA_space_lol
		add_army_tradition_or_mil_power = { amount = 10 }
		set_country_flag = MSA_investment_e_cooldown
		hidden_effect = {
			change_variable = {
				which = ME_Num_of_Foreign_Investments
				value = 1
			}
		}
	}

	option = {
		name = ME_Malaya_Events.67.f

		trigger = {
			check_variable = {
				which = MSA_foreign_investment_amount
				value = 10
			}
			any_ally = {
				capital_scope = {
					continent = europe
				}
			}
			OR = {
				NOT = { has_country_flag = MSA_investment_f_cooldown }
				had_country_flag = {
					flag = MSA_investment_f_cooldown
					days = 3650
				}
			}
		}

		ai_chance = {
			factor = 1
		}

		custom_tooltip = MSA_cooldown_10
		MSA_this_will_cost = { amount = 10 execute = yes }
		custom_tooltip = MSA_space_lol
		custom_tooltip = MSA_get_a_trader
		set_country_flag = MSA_investment_f_cooldown
		hidden_effect = {
			change_variable = {
				which = ME_Num_of_Foreign_Investments
				value = 1
			}
			random_ally = {
				limit = {
					capital_scope = {
						continent = europe
					}
				}
				ROOT = {
					define_advisor = {
						type = trader
						skill = 3
						culture = PREV
						religion = PREV
						cost_multiplier = 0.25
					}
				}
			}
		}
	}

	option = {
		name = ME_Malaya_Events.67.g

		trigger = {
			has_country_flag = MSA_invest_in_production
			check_variable = {
				which = MSA_foreign_investment_amount
				value = 20
			}
			OR = {
				NOT = { has_country_flag = MSA_investment_g_cooldown }
				had_country_flag = {
					flag = MSA_investment_g_cooldown
					days = 5475
				}
			}
			if = {
				limit = {
					is_expanded_mod_active = { mod = trade_goods }
				}
				any_owned_province = {
					OR = {
						trade_goods = spices
						trade_goods = cloves
						trade_goods = nutmeg
						trade_goods = vanilla
					}
					NOT = { has_province_modifier = MSA_enhanced_spice_production }
				}
			}
			else = {
				any_owned_province = {
					OR = {
						trade_goods = spices
						trade_goods = cloves
					}
					NOT = { has_province_modifier = MSA_enhanced_spice_production }
				}
			}
		}

		ai_chance = {
			factor = 1
		}

		custom_tooltip = MSA_cooldown_15
		MSA_this_will_cost = { amount = 20 }
		custom_tooltip = MSA_space_lol
		set_country_flag = MSA_plantation_choice
		custom_tooltip = MSA_plantation_choice
		tooltip = {
			add_province_modifier = {
				name = MSA_enhanced_spice_production
				duration = -1
			}
		}
		country_event = { id = ME_Malaya_Events.68 }
		hidden_effect = {
			#change_variable = {
			#	which = ME_Num_of_Foreign_Investments
			#	value = 1
			#}
		}
	}

	option = {
		name = ME_Malaya_Events.67.h

		ai_chance = {
			factor = 1
		}
	}
}

country_event = {
	id = ME_Malaya_Events.68
	title = ME_Malaya_Events.68.t #Concession - Provicne
	desc = ME_Malaya_Events.68.d
	picture = IMPORTANT_STATUE_eventPicture

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			MSA_set_up_province_targets = yes
		}
	}

	option = {
		name = ME_Malaya_Events.68.a

		trigger = {
			has_country_flag = MSA_1_province
		}

		goto = Malaya_target_1

		ai_chance = {
			factor = 1
		}

		event_target:Malaya_target_1 = {
			MSA_execute_province_effect = yes
		}
	}

	option = {
		name = ME_Malaya_Events.68.b

		trigger = {
			has_country_flag = MSA_2_province
		}

		goto = Malaya_target_2

		ai_chance = {
			factor = 1
		}

		event_target:Malaya_target_2 = {
			MSA_execute_province_effect = yes
		}
	}

	option = {
		name = ME_Malaya_Events.68.c

		trigger = {
			has_country_flag = MSA_3_province
		}

		goto = Malaya_target_3

		ai_chance = {
			factor = 1
		}

		event_target:Malaya_target_3 = {
			MSA_execute_province_effect = yes
		}
	}

	option = {
		name = ME_Malaya_Events.68.e

		trigger = {
			has_country_flag = MSA_4_province
		}

		goto = Malaya_target_4

		ai_chance = {
			factor = 1
		}

		event_target:Malaya_target_4 = {
			MSA_execute_province_effect = yes
		}
	}

	option = {
		name = ME_Malaya_Events.68.f

		trigger = {
			has_country_flag = MSA_5_province
		}

		goto = Malaya_target_5

		ai_chance = {
			factor = 1
		}

		event_target:Malaya_target_5 = {
			MSA_execute_province_effect = yes
		}
	}

	option = {
		name = ME_Malaya_Events.68.g

		ai_chance = {
			factor = 1
		}

		MSA_clear_flags_province_choice = yes
	}

}

province_event = {
	id = ME_Malaya_Events.69
	title = ME_Malaya_Events.69.t #Muslim Center - Malacca Eclipsed?
	desc = ME_Malaya_Events.69.d
	picture = RELIGION_eventPicture

	is_triggered_only = yes
	major = yes
	major_trigger = {
		culture_group = malay
	}

	immediate = {
		hidden_effect = {
			set_global_flag = MSA_muslim_center_flag_being_rivalled
			save_global_event_target_as = ME_MSA_muslim_center_target_rival
		}
	}

	option = {
		name = ME_Malaya_Events.69.a

		ai_chance = {
			factor = 1
		}

		custom_tooltip = MSA_tooltip_being_contested
	}
}

country_event = {
	id = ME_Malaya_Events.70
	title = ME_Malaya_Events.70.t #Muslim Center - Eclipsing Curtailed
	desc = ME_Malaya_Events.70.d
	picture = RELIGION_eventPicture

	is_triggered_only = yes
	major = yes
	major_trigger = {
		culture_group = malay
	}

	option = {
		name = ME_Malaya_Events.70.a

		ai_chance = {
			factor = 1
		}

		custom_tooltip = MSA_tooltip_contest_curtailed
	}

	after = {
		clr_global_flag = MSA_muslim_center_flag_being_rivalled
		clear_global_event_target = ME_MSA_muslim_center_target_rival
	}
}

country_event = {
	id = ME_Malaya_Events.71
	title = ME_Malaya_Events.71.t #Muslim Center - Malacca Eclipsed
	desc = ME_Malaya_Events.71.d
	picture = RELIGION_eventPicture

	major = yes
	major_trigger = {
		culture_group = malay
	}

	trigger = {
		had_global_flag = {
			flag = MSA_muslim_center_flag_being_rivalled
			days = 1825
		}
		event_target:ME_MSA_muslim_center_target_rival = {
			owned_by = ROOT
		}
	}

	mean_time_to_happen = {
		months = 3
	}

	immediate = {
		hidden_effect = {
			clr_global_flag = MSA_muslim_center_flag_being_rivalled
			event_target:ME_MSA_muslim_center_target = {
				remove_province_modifier = MSA_muslim_center
			}
			event_target:ME_MSA_muslim_center_target_rival = {
				save_global_event_target_as = ME_MSA_muslim_center_target
				add_permanent_province_modifier = {
					name = MSA_muslim_center
					duration = -1
				}
			}
			clear_global_event_target = ME_MSA_muslim_center_target_rival
		}
	}

	option = {
		name = ME_Malaya_Events.71.a

		ai_chance = {
			factor = 1
		}

		event_target:ME_MSA_muslim_center_target = {
			add_permanent_province_modifier = {
				name = MSA_muslim_center
				duration = -1
			}
			set_global_flag = MSA_muslim_center_flag
			#save_global_event_target_as = ME_MSA_muslim_center_target
			custom_tooltip = MSA_tooltip
			add_prosperity = 100
		}
	}
}

province_event = {
	id = ME_Malaya_Events.72
	title = ME_Malaya_Events.72.t #Muslim Center - Muslims Lose Ground
	desc = ME_Malaya_Events.72.d
	picture = RELIGION_eventPicture

	major = yes
	major_trigger = {
		culture_group = malay
	}

	trigger = {
		province_id = 596
		has_global_flag = MSA_muslim_center_flag
		NOT = {
			calc_true_if = {
				indonesia_region = {
					type = all
					owner = {
						religion_group = muslim
					}
				}
				malaya_region = {
					type = all
					owner = {
						religion_group = muslim
					}
				}
				amount = 25
			}
		}
	}

	mean_time_to_happen = {
		months = 12
	}

	immediate = {
		hidden_effect = {
			clr_global_flag = MSA_muslim_center_flag_being_rivalled
			clr_global_flag = MSA_muslim_center_flag
			event_target:ME_MSA_muslim_center_target = {
				save_event_target_as = ME_MSA_target_being_removed
			}
			clear_global_event_target = ME_MSA_muslim_center_target_rival
			clear_global_event_target = ME_MSA_muslim_center_target
		}
	}
	option = {
		name = ME_Malaya_Events.72.a

		ai_chance = {
			factor = 1
		}

		custom_tooltip = MSA_tooltip_muslims_losing_ground
		event_target:ME_MSA_target_being_removed = {
			remove_province_modifier = MSA_muslim_center
		}
	}
}

province_event = {
	id = ME_Malaya_Events.73
	title = ME_Malaya_Events.73.t #Muslim Center - Muslims Restore Ground
	desc = ME_Malaya_Events.73.d
	picture = RELIGION_eventPicture

	major = yes
	major_trigger = {
		culture_group = malay
	}

	trigger = {
		province_id = 596
		NOT = { has_global_flag = MSA_muslim_center_flag }
		calc_true_if = {
			indonesia_region = {
				type = all
				owner = {
					religion_group = muslim
				}
			}
			malaya_region = {
				type = all
				owner = {
					religion_group = muslim
				}
			}
			amount = 30
		}
	}

	mean_time_to_happen = {
		months = 12
	}

	immediate = {
		hidden_effect = {
			pick_best_provinces = {
				1 = yes
				global_trigger = "
					OR = {
						region = indonesia_region
						region = malaya_region
					}
				"
				scale = " higher_development_than "
				event_target_name = "ME_MSA_new_center"
				scope = " every_province "
			}
		}
	}

	option = {
		name = ME_Malaya_Events.73.a

		ai_chance = {
			factor = 1
		}

		event_target:ME_MSA_new_center_1 = {
			add_permanent_province_modifier = {
				name = MSA_muslim_center
				duration = -1
			}
			set_global_flag = MSA_muslim_center_flag
			save_global_event_target_as = ME_MSA_muslim_center_target
			custom_tooltip = MSA_tooltip
		}
	}
}

province_event = {
	id = ME_Malaya_Events.74
	title = ME_Malaya_Events.74.t #Muslim Center - Center is lost to non muslim country
	desc = ME_Malaya_Events.74.d
	picture = RELIGION_eventPicture

	major = yes
	major_trigger = {
		culture_group = malay
	}

	trigger = {
		has_global_flag = MSA_muslim_center_flag
		has_province_flag = MSA_muslim_center
		owner = {
			NOT = { religion_group = muslim }
		}
	}

	mean_time_to_happen = {
		months = 12
	}

	immediate = {
		hidden_effect = {
			pick_best_provinces = {
				1 = yes
				global_trigger = "
					OR = {
						region = indonesia_region
						region = malaya_region
					}
				"
				scale = " higher_development_than "
				event_target_name = "ME_MSA_new_center"
				scope = " every_province "
			}
		}
	}

	option = {
		name = ME_Malaya_Events.74.a

		ai_chance = {
			factor = 1
		}

		event_target:ME_MSA_new_center = {
			add_permanent_province_modifier = {
				name = MSA_muslim_center
				duration = -1
			}
			set_global_flag = MSA_muslim_center_flag
			save_global_event_target_as = ME_MSA_muslim_center_target
			custom_tooltip = MSA_tooltip
		}

		owner = {
			add_power_projection = {
				type = mission_rewards_power_projection
				amount = 10
			}
		}
	}
}

############################
#
#	Spread of Islam in Nusantara
#
#	Below there is an event that brings forth a natural,
#	independent spread of islam through Malaya.
#	Dependant on several factors that impact its speed,
# 	Its main purposes is spreading Islam slowly and gradually, without
#	the interference of personal events, such as the ones that
# 	Champa or Majapahit have.
#	Factors that impact its speed will be written down in the event MTTH.
#	Islam will try to spread especially among trade routes (trade centers)
#
#
############################

province_event = {
	id = ME_Malaya_Events.75
	title = ME_Malaya_Events.75.t #Events relating to Spread of Islam
	desc = ME_Malaya_Events.75.d
	picture = RELIGION_eventPicture

	hidden = yes

	trigger = {
		province_id = 596 #Melaka, basically trying to have the logic here done only once.
		#had_global_flag = {
		#}
	}

	mean_time_to_happen = {
		months = 60
		modifier = {
			factor = 1.00
			current_age = age_of_discovery
		}
		modifier = {
			factor = 0.75
			current_age = age_of_reformation
		}
		modifier = {
			factor = 1.25
			current_age = age_of_absolutism
		}
		modifier = {
			factor = 1.50
			current_age = age_of_revolutions
		}

		modifier = {
			factor = 50
			has_global_flag = MSA_spread_of_islam_slowdown_flag_india
		}
	}

	#Todo: make this pain not inflict physical pain upon the reader
	immediate = {
		hidden_effect = {
			random_list = {
				60 = { #this roll is for the "route" spread. likely to fail and just execute the code below
					MSA_spread_of_islam_route_spread = yes
				}
				40 = { #regular roll, random spread to any border province
					MSA_spread_of_islam_normal_spread = yes
				}
			}
		}
	}

	option = {
		name = ME_Malaya_Events.74.a

		ai_chance = {
			factor = 1
		}

		event_target:MSA_target_province_religion = {
			change_religion = event_target:MSA_origin_province_religion
			province_event = { id = ME_Malaya_Events.76 }
		}
	}
}

province_event = {
	id = ME_Malaya_Events.76
	title = ME_Malaya_Events.76.t #Event to inform the nation about spread of islam
	desc = ME_Malaya_Events.76.d
	picture = RELIGION_eventPicture

	is_triggered_only = yes

	goto = ROOT

	option = {
		name = ME_Malaya_Events.76.a

		ai_chance = {
			factor = 1
		}

		custom_tooltip = MSA_converted
		hidden_effect = {
			owner = {
				set_country_flag = MSA_enabled_spread_of_islam_decision 
			}
		}
	}
}

country_event = {
	id = ME_Malaya_Events.77
	title = ME_Malaya_Events.77.t #Religious Zeal - Catholic
	desc = ME_Malaya_Events.77.d
	picture = RELIGION_eventPicture

	fire_only_once = yes

	trigger = {
		tag = MSA
		has_country_flag = MSA_chose_religious_tree
		NOT = { religion_group = christian }
		if = {
			limit = {
				has_country_flag = MSA_spread_of_christianity_slow
			}
			check_variable = {
				which = MSA_amount_of_christian_conversions
				value = 4
			}
		}
		else = {
			check_variable = {
				which = MSA_amount_of_christian_conversions
				value = 6
			}
		}
	}

	mean_time_to_happen = {
		months = 12
	}

	# option = { Christian tree will come in a future update.
		# name = ME_Malaya_Events.77.a

		# ai_chance = {
			# factor = 1
		# }
		# trigger = {
			# NOT = {
				# has_country_flag = MSA_spread_of_christianity_slow
			# }
		# }

		# set_country_flag = MSA_religion_christian
		# clr_country_flag = MSA_religion_hindu
		# clr_country_flag = MSA_religion_muslim
		# set_country_flag = MSA_chose_religious_tree
		# swap_non_generic_missions = yes
	# }

	option = {
		name = ME_Malaya_Events.77.b

		ai_chance = {
			factor = 1
		}

		custom_tooltip = MSA_spread_of_christianity_will_cease
		clr_country_flag = MSA_spread_of_christianity
	}
}

country_event = {
	id = ME_Malaya_Events.78
	title = ME_Malaya_Events.78.t #Malaya Event - Colonizing isles
	desc = ME_Malaya_Events.78.d
	picture = COURT_eventPicture

	trigger = {
		has_country_flag = MSA_events_for_missing_provs
		OR = {
			2684 = { is_empty = yes }
			621 = { is_empty = yes }
			2683 = { is_empty = yes }
			2679 = { is_empty = yes }
			2693 = { is_empty = yes }
			632 = { is_empty = yes }
			2706 = { is_empty = yes }
			2708 = { is_empty = yes }
			4845 = { is_empty = yes }
			643 = { is_empty = yes }
			4796 = { is_empty = yes }
			2714 = { is_empty = yes }
			2713 = { is_empty = yes }
			644 = { is_empty = yes }
		}
	}

	mean_time_to_happen = {
		months = 12
	}

	immediate = {
		hidden_effect = {
			random_list = {
				1 = {
					trigger = {
						2684 = { is_empty = yes }
					}
					2684 = { save_event_target_as = MSA_province }
				}
				1 = {
					trigger = {
						621 = { is_empty = yes }
					}
					621 = { save_event_target_as = MSA_province }
				}
				1 = {
					trigger = {
						2683 = { is_empty = yes }
					}
					2683 = { save_event_target_as = MSA_province }
				}
				1 = {
					trigger = {
						2679 = { is_empty = yes }
					}
					2679 = { save_event_target_as = MSA_province }
				}
				1 = {
					trigger = {
						2693 = { is_empty = yes }
					}
					2693 = { save_event_target_as = MSA_province }
				}
				1 = {
					trigger = {
						632 = { is_empty = yes }
					}
					632 = { save_event_target_as = MSA_province }
				}
				1 = {
					trigger = {
						2706 = { is_empty = yes }
					}
					2706 = { save_event_target_as = MSA_province }
				}
				1 = {
					trigger = {
						2708 = { is_empty = yes }
					}
					2708 = { save_event_target_as = MSA_province }
				}
				1 = {
					trigger = {
						4845 = { is_empty = yes }
					}
					4845 = { save_event_target_as = MSA_province }
				}
				1 = {
					trigger = {
						643 = { is_empty = yes }
					}
					643 = { save_event_target_as = MSA_province }
				}
				1 = {
					trigger = {
						4796 = { is_empty = yes }
					}
					4796 = { save_event_target_as = MSA_province }
				}
				1 = {
					trigger = {
						2714 = { is_empty = yes }
					}
					2714 = { save_event_target_as = MSA_province }
				}
				1 = {
					trigger = {
						2713 = { is_empty = yes }
					}
					2713 = { save_event_target_as = MSA_province }
				}
				1 = {
					trigger = {
						644 = { is_empty = yes }
					}
					644 = { save_event_target_as = MSA_province }
				}
			}
		}
	}

	option = {
		name = ME_Malaya_Events.78.a

		highlight = yes

		trigger = {
			custom_trigger_tooltip = {
				tooltip = MSA_completed_people_of_nusantara_mission
				always = yes
			}
		}

		ai_chance = {
			factor = 1
		}

		event_target:MSA_province = {
			add_siberian_construction = 10
		}
	}
}

country_event = {
	id = ME_Malaya_Events.79
	title = ME_Malaya_Events.79.t #Malaya Event - Colonizing philippines
	desc = ME_Malaya_Events.79.d
	picture = COURT_eventPicture

	trigger = {
		has_country_flag = MSA_events_will_gradually_fire_to_colonize_the_rest_of_phillipines
		OR = {
			southern_luzon_area = { is_empty = yes }
			luzon_area = { is_empty = yes }
			visayas_area = { is_empty = yes }
			mindanao_area = { is_empty = yes }
			west_mindanao_area = { is_empty = yes }
			palawan_area = { is_empty = yes }
		}
	}

	mean_time_to_happen = {
		months = 60
	}

	immediate = {
		hidden_effect = {
			random_province = {
				limit = {
					is_empty = yes
					OR = {
						area = southern_luzon_area
						area = luzon_area
						area = visayas_area
						area = mindanao_area
						area = west_mindanao_area
						area = palawan_area
					}
				}
				save_event_target_as = MSA_province
			}
		}
	}

	option = {
		name = ME_Malaya_Events.79.a

		ai_chance = {
			factor = 1
		}

		event_target:MSA_province = {
			add_siberian_construction = 10
		}
	}
}

#### Events relating to the Canton

country_event = {
	id = ME_Malaya_Events.80
	title = ME_Malaya_Events.80.t #Malaya Event - Random Canton Event
	desc = ME_Malaya_Events.80.d
	picture = NAVAL_MILITARY_eventPicture

	hidden = yes

	trigger = {
		has_country_flag = MSA_canton_community
	}

	mean_time_to_happen = {
		months = 60
	}

	immediate = {
		hidden_effect = {
			random_list = {
				1 = {
					country_event = { id = ME_Malaya_Events.81 }
				}
				1 = {
					country_event = { id = ME_Malaya_Events.82 }
				}
				1 = {
					country_event = { id = ME_Malaya_Events.83 }
				}
				1 = {
					country_event = { id = ME_Malaya_Events.84 }
				}
			}
		}
	}

	option = {
		name = ME_Malaya_Events.80.a

		ai_chance = {
			factor = 1
		}
	}
}

country_event = {
	id = ME_Malaya_Events.81
	title = ME_Malaya_Events.81.t
	desc = ME_Malaya_Events.81.d
	picture = ECONOMY_eventPicture

	is_triggered_only = yes

	option = {
		name = ME_Malaya_Events.81.a

		ai_chance = {
			factor = 1
		}

		MSA_expand_canton_effect = yes
		add_adm_power = -50
	}

	option = {
		name = ME_Malaya_Events.81.b

		ai_chance = {
			factor = 1
		}
	}
}

country_event = {
	id = ME_Malaya_Events.82
	title = ME_Malaya_Events.82.t
	desc = ME_Malaya_Events.82.d
	picture = NAVAL_MILITARY_eventPicture

	is_triggered_only = yes

	option = {
		name = ME_Malaya_Events.82.a

		ai_chance = {
			factor = 1
		}

		MSA_expand_canton_effect = yes
		add_yearly_sailors = -3
	}

	option = {
		name = ME_Malaya_Events.82.b

		ai_chance = {
			factor = 1
		}
	}
}

country_event = {
	id = ME_Malaya_Events.83
	title = ME_Malaya_Events.83.t
	desc = ME_Malaya_Events.83.d
	picture = NAVAL_MILITARY_eventPicture

	is_triggered_only = yes

	option = {
		name = ME_Malaya_Events.83.a

		ai_chance = {
			factor = 1
		}

		MSA_expand_canton_effect = yes
		add_inflation = 1.5
	}

	option = {
		name = ME_Malaya_Events.83.b

		ai_chance = {
			factor = 1
		}
	}
}

country_event = {
	id = ME_Malaya_Events.84
	title = ME_Malaya_Events.84.t
	desc = ME_Malaya_Events.84.d
	picture = ECONOMY_eventPicture

	is_triggered_only = yes

	option = {
		name = ME_Malaya_Events.84.a

		ai_chance = {
			factor = 1
		}

		MSA_shrink_canton_effect = yes
	}

	option = {
		name = ME_Malaya_Events.84.a

		ai_chance = {
			factor = 1
		}

		add_stability = -1
	}
}

country_event = {
	id = ME_Malaya_Events.85
	title = ME_Malaya_Events.85.t
	desc = ME_Malaya_Events.85.d
	picture = NAVAL_MILITARY_eventPicture

	is_triggered_only = yes

	option = {
		name = ME_Malaya_Events.84.a

		ai_chance = {
			factor = 1
		}

		MSA_shrink_canton_effect = yes
	}

	option = {
		name = ME_Malaya_Events.84.a

		ai_chance = {
			factor = 1
		}

		add_stability = -1
	}
}

country_event = {
	id = ME_Malaya_Events.86
	title = ME_Malaya_Events.86.t
	desc = ME_Malaya_Events.86.d
	picture = ECONOMY_eventPicture

	is_triggered_only = yes

	option = {
		name = ME_Malaya_Events.86.a

		ai_chance = {
			factor = 1
		}
		trigger = {
			has_dlc = "Leviathan"
		}

		remove_country_modifier = MSA_great_project
		add_country_modifier = {
			name = MSA_great_project_2b
			duration = -1
		}
	}

	option = {
		name = ME_Malaya_Events.86.b

		ai_chance = {
			factor = 1
		}

		remove_country_modifier = MSA_great_project
		add_country_modifier = {
			name = MSA_great_project_2a
			duration = -1
		}
	}
}

country_event = {
	id = ME_Malaya_Events.87
	title = ME_Malaya_Events.87.t
	desc = ME_Malaya_Events.87.d
	picture = NAVAL_MILITARY_eventPicture

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			if = {
				limit = {
					has_country_flag = MSA_cocoa_flag
				}
				MSA_event_87_potential = { goods = cocoa }
			}
			else_if = {
				limit = {
					has_country_flag = MSA_coffee_flag
				}
				MSA_event_87_potential = { goods = coffee }
			}
		}
	}

	option = {
		name = ME_Malaya_Events.87.a

		ai_chance = {
			factor = 1
		}

		MSA_87_execute_effect = { id = 1 }
	}

	option = {
		name = ME_Malaya_Events.87.b

		ai_chance = {
			factor = 1
		}

		MSA_87_execute_effect = { id = 2 }
	}

	option = {
		name = ME_Malaya_Events.87.c

		ai_chance = {
			factor = 1
		}

		MSA_87_execute_effect = { id = 3 }
	}

	option = {
		name = ME_Malaya_Events.87.e

		ai_chance = {
			factor = 1
		}

		if = {
			limit = {
				has_dlc = "Mandate of Heaven"
			}
			custom_tooltip = MSA_reserved
		}
		MSA_87_execute_effect = { id = 4 }
	}

	option = {
		name = ME_Malaya_Events.87.f

		ai_chance = {
			factor = 1
		}

		if = {
			limit = {
				has_dlc = "Mandate of Heaven"
			}
			custom_tooltip = MSA_reserved
		}
		MSA_87_execute_effect = { id = 5 }
	}

	option = {
		name = ME_Malaya_Events.87.g

		ai_chance = {
			factor = 1
		}
	}

	after = {
		MSA_87_clr_flags = yes
	}
}

country_event = {
	id = ME_Malaya_Events.88
	title = ME_Malaya_Events.88.t
	desc = ME_Malaya_Events.88.d
	picture = IMPORTANT_STATUE_eventPicture

	is_triggered_only = yes

	option = {
		name = ME_Malaya_Events.88.a

		trigger = {
			check_variable = {
				which = MSA_cocoa_provinces
				value = 1
			}
		}

		ai_chance = {
			factor = 1
		}

		set_country_flag = MSA_cocoa_flag
		country_event = { id = ME_Malaya_Events.87 }
	}

	option = {
		name = ME_Malaya_Events.88.b

		trigger = {
			check_variable = {
				which = MSA_coffee_provinces
				value = 1
			}
		}

		ai_chance = {
			factor = 1
		}

		set_country_flag = MSA_coffee_flag
		country_event = { id = ME_Malaya_Events.87 }
	}
}